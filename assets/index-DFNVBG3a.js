import{f as je,j as e,N as he,u as Ze,r as i,E as Xe,h as Je,a as Qe,R as es,b as ue,c as ss,d as ts,H as ls}from"./vendor-Cosd68Z-.js";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))x(h);new MutationObserver(h=>{for(const d of h)if(d.type==="childList")for(const o of d.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&x(o)}).observe(document,{childList:!0,subtree:!0});function l(h){const d={};return h.integrity&&(d.integrity=h.integrity),h.referrerPolicy&&(d.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?d.credentials="include":h.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function x(h){if(h.ep)return;h.ep=!0;const d=l(h);fetch(h.href,d)}})();const as={apiKey:"AIzaSyAc2g-t9A7du3K_nI2fJnw_OGxhmLfpP6s",authDomain:"dilistname.firebaseapp.com",databaseURL:"https://dilistname-default-rtdb.firebaseio.com",projectId:"dilistname",storageBucket:"dilistname.firebasestorage.app",messagingSenderId:"897983357871",appId:"1:897983357871:web:42a046bc9fb3e0543dc55a",measurementId:"G-NQ798D9J6K"};je.apps.length||je.initializeApp(as);const q=je.database(),be=je.auth(),k=({children:s,className:c,...l})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:c,...l,children:s}),ns=s=>e.jsxs(k,{...s,children:[e.jsx("line",{x1:"4",x2:"20",y1:"12",y2:"12"}),e.jsx("line",{x1:"4",x2:"20",y1:"6",y2:"6"}),e.jsx("line",{x1:"4",x2:"20",y1:"18",y2:"18"})]}),ce=s=>e.jsxs(k,{...s,children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),rs=s=>e.jsx(k,{...s,children:e.jsx("polyline",{points:"15 18 9 12 15 6"})}),Re=s=>e.jsx(k,{...s,children:e.jsx("polyline",{points:"9 18 15 12 9 6"})}),is=s=>e.jsx(k,{...s,children:e.jsx("polyline",{points:"6 9 12 15 18 9"})}),fe=s=>e.jsxs(k,{...s,children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.3-4.3"})]}),os=s=>e.jsx(k,{...s,children:e.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),me=s=>e.jsxs(k,{...s,children:[e.jsx("polyline",{points:"1 4 1 10 7 10"}),e.jsx("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})]}),Ge=s=>e.jsx(k,{...s,children:e.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),Ce=s=>e.jsxs(k,{...s,children:[e.jsx("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),e.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]}),Te=s=>e.jsx(k,{...s,children:e.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"})}),ne=s=>e.jsxs(k,{...s,children:[e.jsx("polyline",{points:"3 6 5 6 21 6"}),e.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"}),e.jsx("line",{x1:"10",y1:"11",x2:"10",y2:"17"}),e.jsx("line",{x1:"14",y1:"11",x2:"14",y2:"17"})]}),ds=s=>e.jsxs(k,{...s,children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",x2:"12",y1:"3",y2:"15"})]}),we=s=>e.jsxs(k,{...s,children:[e.jsx("polyline",{points:"6 9 6 2 18 2 18 9"}),e.jsx("path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"}),e.jsx("rect",{x:"6",y:"14",width:"12",height:"8"})]}),cs=s=>e.jsxs(k,{...s,children:[e.jsx("line",{x1:"22",x2:"11",y1:"2",y2:"13"}),e.jsx("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]}),Ie=s=>e.jsxs(k,{...s,children:[e.jsx("path",{d:"M12 19V5"}),e.jsx("path",{d:"M5 12l7-7 7 7"})]}),$e=s=>e.jsxs(k,{...s,children:[e.jsx("path",{d:"M12 5v14"}),e.jsx("path",{d:"M19 12l-7 7-7-7"})]}),Ye=s=>e.jsxs(k,{...s,children:[e.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),e.jsx("path",{d:"M3 5V19A9 3 0 0 0 21 19V5"}),e.jsx("path",{d:"M3 12A9 3 0 0 0 21 12"})]}),_e=s=>e.jsxs(k,{...s,children:[e.jsx("rect",{width:"7",height:"7",x:"3",y:"3",rx:"1"}),e.jsx("rect",{width:"7",height:"7",x:"14",y:"3",rx:"1"}),e.jsx("rect",{width:"7",height:"7",x:"14",y:"14",rx:"1"}),e.jsx("rect",{width:"7",height:"7",x:"3",y:"14",rx:"1"})]}),xs=s=>e.jsxs(k,{...s,children:[e.jsx("line",{x1:"8",x2:"21",y1:"6",y2:"6"}),e.jsx("line",{x1:"8",x2:"21",y1:"12",y2:"12"}),e.jsx("line",{x1:"8",x2:"21",y1:"18",y2:"18"}),e.jsx("line",{x1:"3",x2:"3.01",y1:"6",y2:"6"}),e.jsx("line",{x1:"3",x2:"3.01",y1:"12",y2:"12"}),e.jsx("line",{x1:"3",x2:"3.01",y1:"18",y2:"18"})]}),pe=s=>e.jsxs(k,{...s,children:[e.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),Ue=s=>e.jsxs(k,{...s,children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),hs=s=>e.jsxs(k,{...s,children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("polyline",{points:"16 11 18 13 22 9"})]}),us=s=>e.jsxs(k,{...s,children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("line",{x1:"19",x2:"19",y1:"8",y2:"14"}),e.jsx("line",{x1:"22",x2:"16",y1:"11",y2:"11"})]}),ms=s=>e.jsxs(k,{...s,children:[e.jsx("rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2"}),e.jsx("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})]}),ps=s=>e.jsxs(k,{...s,children:[e.jsx("rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",x2:"16",y1:"2",y2:"6"}),e.jsx("line",{x1:"8",x2:"8",y1:"2",y2:"6"}),e.jsx("line",{x1:"3",x2:"21",y1:"10",y2:"10"})]}),Ve=s=>e.jsxs(k,{...s,children:[e.jsx("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.35a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),gs=s=>e.jsxs(k,{...s,children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",x2:"9",y1:"12",y2:"12"})]}),bs=s=>e.jsxs(k,{...s,children:[e.jsx("path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"}),e.jsx("path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0"})]}),Be=s=>e.jsxs(k,{...s,children:[e.jsx("polyline",{points:"9 11 12 14 22 4"}),e.jsx("path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"})]}),He=s=>e.jsxs(k,{...s,children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),We=s=>e.jsxs(k,{...s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",x2:"12",y1:"8",y2:"12"}),e.jsx("line",{x1:"12",x2:"12.01",y1:"16",y2:"16"})]}),fs=s=>e.jsxs(k,{...s,children:[e.jsx("path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"}),e.jsx("line",{x1:"12",x2:"12",y1:"9",y2:"13"}),e.jsx("line",{x1:"12",x2:"12.01",y1:"17",y2:"17"})]}),js=s=>e.jsxs(k,{...s,children:[e.jsx("path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),ws=s=>e.jsxs(k,{...s,children:[e.jsx("path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}),e.jsx("circle",{cx:"12",cy:"13",r:"3"})]}),ve=({className:s})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:s,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 13l4 4L19 7"})}),vs=({sidebarOpen:s,setSidebarOpen:c,adminProfile:l,user:x,handleLogout:h})=>e.jsxs("aside",{className:`fixed inset-y-4 left-4 z-50 w-72 glass-sidebar rounded-3xl transform transition-transform duration-500 ease-in-out md:relative md:translate-x-0 md:inset-y-0 md:left-0 md:rounded-none md:border-r md:bg-slate-900 ${s?"translate-x-0":"-translate-x-[120%] md:translate-x-0"} flex flex-col shadow-2xl`,children:[e.jsx("div",{className:"h-24 flex items-center justify-center border-b border-white/5",children:e.jsxs("div",{className:"flex items-center gap-3 font-extrabold text-2xl tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-400",children:[e.jsx(Ye,{className:"h-8 w-8 text-blue-500"})," HR PRO"]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto py-8 px-4 space-y-2",children:[e.jsx("p",{className:"px-4 text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Menu"}),e.jsxs(he,{to:"/",onClick:()=>c(!1),className:({isActive:d})=>`w-full flex items-center gap-4 px-6 py-4 rounded-2xl transition-all duration-300 font-bold ${d?"active-nav-item shadow-lg shadow-blue-900/20":"text-slate-400 hover:bg-white/5 hover:text-white"}`,children:[e.jsx(_e,{className:"h-5 w-5"})," ផ្ទាំងគ្រប់គ្រង"]}),e.jsxs(he,{to:"/employees",onClick:()=>c(!1),className:({isActive:d})=>`w-full flex items-center gap-4 px-6 py-4 rounded-2xl transition-all duration-300 font-bold ${d?"active-nav-item shadow-lg shadow-blue-900/20":"text-slate-400 hover:bg-white/5 hover:text-white"}`,children:[e.jsx(Ue,{className:"h-5 w-5"})," បុគ្គលិក"]}),e.jsxs(he,{to:"/bulk-edit",onClick:()=>c(!1),className:({isActive:d})=>`w-full flex items-center gap-4 px-6 py-4 rounded-2xl transition-all duration-300 font-bold ${d?"active-nav-item shadow-lg shadow-blue-900/20":"text-slate-400 hover:bg-white/5 hover:text-white"}`,children:[e.jsx(Be,{className:"h-5 w-5"})," កែប្រែទិន្នន័យ"]}),e.jsxs(he,{to:"/recycle-bin",onClick:()=>c(!1),className:({isActive:d})=>`w-full flex items-center gap-4 px-6 py-4 rounded-2xl transition-all duration-300 font-bold ${d?"bg-red-500/10 text-red-400 border-l-4 border-red-500":"text-slate-400 hover:bg-white/5 hover:text-white"}`,children:[e.jsx(ne,{className:"h-5 w-5"})," ធុងសំរាម"]}),e.jsx("div",{className:"my-6 border-t border-white/5"}),e.jsx("p",{className:"px-4 text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"System"}),e.jsxs(he,{to:"/settings",onClick:()=>c(!1),className:({isActive:d})=>`w-full flex items-center gap-4 px-6 py-4 rounded-2xl transition-all duration-300 font-bold ${d?"active-nav-item shadow-lg shadow-blue-900/20":"text-slate-400 hover:bg-white/5 hover:text-white"}`,children:[e.jsx(Ve,{className:"h-5 w-5"})," ការកំណត់"]})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-gradient-to-br from-indigo-600 to-blue-700 rounded-2xl p-4 text-center",children:[e.jsx("p",{className:"text-white text-sm font-bold mb-0.5",children:l?.username||x?.email||"Admin"}),e.jsx("p",{className:"text-white/60 text-xs font-medium opacity-80 mb-3",children:l?.role||"User"}),e.jsxs("button",{onClick:h,className:"w-full flex items-center justify-center gap-2 px-4 py-2 rounded-xl bg-white/20 hover:bg-white/30 text-white transition-all text-sm font-bold backdrop-blur-sm",children:[e.jsx(gs,{className:"h-4 w-4"})," Sign Out"]})]})})]}),Ns=({setSidebarOpen:s,adminProfile:c,user:l})=>{const x=Ze(),h=()=>{switch(x.pathname){case"/":return"Dashboard Overview";case"/employees":return"Employee Management";case"/recycle-bin":return"Recycle Bin";case"/settings":return"System Settings";case"/bulk-edit":return"Bulk Edit Mode";default:return"HR Pro"}};return e.jsxs("header",{className:"h-20 glass-panel border-b-0 m-4 rounded-3xl flex items-center justify-between px-8 z-30 shrink-0 sticky top-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>s(!0),className:"md:hidden p-2 rounded-xl hover:bg-slate-100 text-slate-600",children:e.jsx(ns,{className:"h-6 w-6"})}),e.jsx("h1",{className:"text-2xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-slate-700 to-slate-500 hidden sm:block",children:h()})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(bs,{className:"h-6 w-6 text-slate-400 hover:text-indigo-500 transition-colors cursor-pointer"}),e.jsx("span",{className:"absolute -top-1 -right-1 h-3 w-3 bg-red-500 rounded-full border-2 border-white"})]}),e.jsx("div",{className:"h-8 w-[1px] bg-slate-200"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right hidden md:block",children:[e.jsx("div",{className:"text-sm font-bold text-slate-700",children:c?.username||l?.email||"Admin User"}),e.jsx("div",{className:"text-xs text-slate-400 font-medium",children:c?.role||"Loading..."})]}),e.jsx("div",{className:"h-10 w-10 rounded-full bg-gradient-to-r from-blue-500 to-indigo-600 flex items-center justify-center text-white font-bold shadow-lg ring-2 ring-white",children:c?.username?c.username.charAt(0).toUpperCase():l?.email?l.email.charAt(0).toUpperCase():"A"})]})]})]})},ys=({onLogin:s,loading:c,error:l})=>{const[x,h]=i.useState("admin@dilistname.com"),[d,o]=i.useState(""),S=m=>{m.preventDefault(),s(x,d)};return e.jsxs("div",{className:"min-h-screen w-full flex items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 relative overflow-hidden font-sans",children:[e.jsx("div",{className:"absolute top-[-10%] left-[-10%] w-[500px] h-[500px] bg-indigo-500/20 rounded-full blur-[120px] animate-pulse"}),e.jsx("div",{className:"absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-blue-500/20 rounded-full blur-[120px] animate-pulse delay-1000"}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-2xl border border-white/10 p-10 rounded-[40px] shadow-2xl w-full max-w-md m-4 animate-fade-in z-10 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-blue-500 to-indigo-500"}),e.jsxs("div",{className:"flex flex-col items-center mb-10",children:[e.jsx("div",{className:"h-20 w-20 bg-gradient-to-tr from-blue-500 to-indigo-600 rounded-3xl flex items-center justify-center shadow-lg shadow-indigo-500/30 mb-6 transform rotate-6 border border-white/20",children:e.jsx(Ye,{className:"h-10 w-10 text-white"})}),e.jsx("h1",{className:"text-4xl font-extrabold text-white tracking-tight mb-2",children:"HR PRO"}),e.jsx("p",{className:"text-slate-400 text-sm font-medium",children:"Please sign in to continue"})]}),e.jsxs("form",{onSubmit:S,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider ml-2",children:"Email Address"}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(pe,{className:"h-5 w-5 text-slate-500 group-focus-within:text-blue-400 transition-colors"})}),e.jsx("input",{type:"email",value:x,onChange:m=>h(m.target.value),className:"block w-full pl-12 pr-4 py-4 bg-slate-900/60 border border-slate-700/50 rounded-2xl text-white placeholder-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 transition-all font-medium",placeholder:"admin@dilistname.com",required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider ml-2",children:"Password"}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsxs("svg",{className:"h-5 w-5 text-slate-500 group-focus-within:text-blue-400 transition-colors",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2"}),e.jsx("path",{d:"M7 11V7a5 5 0 0 1 10 0v4"})]})}),e.jsx("input",{type:"password",value:d,onChange:m=>o(m.target.value),className:"block w-full pl-12 pr-4 py-4 bg-slate-900/60 border border-slate-700/50 rounded-2xl text-white placeholder-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500/50 transition-all font-medium",placeholder:"••••••••••••",required:!0})]})]}),l&&e.jsxs("div",{className:"bg-red-500/10 border border-red-500/20 rounded-2xl p-4 flex items-center gap-3 text-red-200 text-sm animate-pulse",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-red-500 shrink-0"}),l]}),e.jsx("button",{type:"submit",disabled:c,className:"w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-bold py-4 rounded-2xl shadow-xl shadow-indigo-600/20 active:scale-[0.98] transition-all disabled:opacity-70 disabled:cursor-not-allowed flex items-center justify-center gap-3 mt-4",children:c?e.jsx("div",{className:"h-5 w-5 border-2 border-white/30 border-t-white rounded-full animate-spin"}):e.jsxs(e.Fragment,{children:["Sign In ",e.jsx(Re,{className:"h-5 w-5"})]})})]}),e.jsx("div",{className:"mt-10 text-center",children:e.jsx("p",{className:"text-slate-500 text-xs font-medium",children:"Secured by Google Firebase"})})]})]})},ks=({isOpen:s,onClose:c,sortData:l,onConfirmSort:x})=>!s||!l?null:e.jsxs("div",{className:"fixed inset-0 z-[100] flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity",onClick:c}),e.jsx("div",{className:"relative bg-white rounded-3xl shadow-2xl w-full max-w-sm overflow-hidden transform transition-all scale-100 animate-fade-in border border-white/20",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Sort By"}),e.jsx("p",{className:"text-sm text-indigo-500 font-medium",children:l.label})]}),e.jsx("button",{onClick:c,className:"p-2 bg-slate-100 hover:bg-slate-200 rounded-full text-slate-500 transition-colors",children:e.jsx(ce,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>x(l.key,"asc"),className:`w-full flex items-center justify-between p-4 rounded-2xl border transition-all ${l.currentDirection==="asc"&&l.currentKey===l.key?"bg-indigo-50 border-indigo-500 ring-1 ring-indigo-500 text-indigo-700":"bg-white border-slate-200 hover:border-indigo-300 hover:bg-slate-50 text-slate-700"}`,children:[e.jsxs("span",{className:"font-bold flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg text-indigo-600",children:e.jsx(Ie,{className:"h-4 w-4"})}),"Ascending (A-Z / 0-9)"]}),l.currentDirection==="asc"&&l.currentKey===l.key&&e.jsx(ve,{className:"h-5 w-5 text-indigo-600"})]}),e.jsxs("button",{onClick:()=>x(l.key,"desc"),className:`w-full flex items-center justify-between p-4 rounded-2xl border transition-all ${l.currentDirection==="desc"&&l.currentKey===l.key?"bg-indigo-50 border-indigo-500 ring-1 ring-indigo-500 text-indigo-700":"bg-white border-slate-200 hover:border-indigo-300 hover:bg-slate-50 text-slate-700"}`,children:[e.jsxs("span",{className:"font-bold flex items-center gap-2",children:[e.jsx("div",{className:"p-2 bg-indigo-100 rounded-lg text-indigo-600",children:e.jsx($e,{className:"h-4 w-4"})}),"Descending (Z-A / 9-0)"]}),l.currentDirection==="desc"&&l.currentKey===l.key&&e.jsx(ve,{className:"h-5 w-5 text-indigo-600"})]}),e.jsx("div",{className:"border-t border-slate-100 my-4"}),e.jsxs("button",{onClick:()=>x(l.key,null,!0),className:"w-full flex items-center justify-center gap-2 p-4 rounded-2xl bg-slate-50 text-slate-500 font-bold hover:bg-red-50 hover:text-red-500 transition-colors",children:[e.jsx(me,{className:"h-4 w-4"}),"Reset / Clear Sort"]})]})]})})]}),ee=({label:s,sortKey:c,currentSort:l,onOpenSort:x,className:h=""})=>{const d=l||{key:null,direction:"asc"};return e.jsx("th",{className:`px-4 py-4 text-left text-xs font-extrabold text-slate-500 uppercase tracking-wider cursor-pointer hover:bg-slate-100 transition-colors group select-none ${h}`,onClick:()=>x(c,s),children:e.jsx("div",{className:"flex items-center gap-1.5 justify-between",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[s,e.jsx("span",{className:"text-slate-400 flex flex-col",children:d.key===c?d.direction==="asc"?e.jsx(Ie,{className:"h-3 w-3 text-indigo-600"}):e.jsx($e,{className:"h-3 w-3 text-indigo-600"}):e.jsxs("div",{className:"opacity-0 group-hover:opacity-50 transition-opacity",children:[e.jsx(Ie,{className:"h-2 w-2 mb-[-2px]"}),e.jsx($e,{className:"h-2 w-2"})]})})]})})})},Oe=({className:s,currentPage:c,totalPages:l,totalItems:x,itemsPerPage:h,onPageChange:d})=>e.jsxs("div",{className:s,children:[e.jsxs("div",{className:"text-xs font-medium text-slate-500 mb-2 md:mb-0",children:["Showing ",x>0?(c-1)*h+1:0," to ",Math.min(c*h,x)," of ",x]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>d(Math.max(c-1,1)),disabled:c===1,className:"p-2 rounded-lg bg-white border border-slate-200 hover:bg-slate-50 disabled:opacity-50 text-slate-600 shadow-sm transition-all active:scale-95",children:e.jsx(rs,{className:"h-4 w-4"})}),e.jsxs("div",{className:"px-4 py-1.5 bg-white border border-slate-200 rounded-lg text-sm font-bold text-slate-700 shadow-sm min-w-[80px] text-center flex items-center justify-center",children:[c," / ",Math.max(l,1)]}),e.jsx("button",{onClick:()=>d(Math.min(c+1,l)),disabled:c===l||l===0,className:"p-2 rounded-lg bg-white border border-slate-200 hover:bg-slate-50 disabled:opacity-50 text-slate-600 shadow-sm transition-all active:scale-95",children:e.jsx(Re,{className:"h-4 w-4"})})]})]}),Ss="/DI_Management/assets/di3-copy-CQzuYy1E.png",Cs=36,Is=24,$s=[{key:"index",label:"NO."},{key:"studentId",label:"ID"},{key:"name",label:"ឈ្មោះ (KH)"},{key:"latinName",label:"Name (EN)"},{key:"gender",label:"ភេទ"},{key:"dob",label:"ថ្ងៃកំណើត"},{key:"position",label:"តួនាទី"},{key:"group",label:"ក្រុម"},{key:"section",label:"ផ្នែក"},{key:"class",label:"ថ្នាក់"},{key:"academicYear",label:"ឆ្នាំសិក្សា"},{key:"telegram",label:"Telegram"},{key:"attendance",label:"ATTENDANCE"}];function Ms({isOpen:s,onClose:c,employees:l=[]}){const[x]=i.useState("Digital Industry"),[h,d]=i.useState("all"),[o,S]=i.useState(""),[m,M]=i.useState(!1),[D,b]=i.useState(0),[L,z]=i.useState(0),[p,_]=i.useState(null),[U,W]=i.useState($s.map(r=>({...r,selected:["index","studentId","name","gender","position","group","attendance"].includes(r.key)}))),[A,w]=i.useState([]);i.useEffect(()=>{if(p){const r=setTimeout(()=>_(null),3e3);return()=>clearTimeout(r)}},[p]);const O=r=>{W(t=>t.map(a=>a.key===r?{...a,selected:!a.selected}:a))},f=()=>{w([...A,{id:Date.now(),label:"Check",type:"checkbox"}])},y=r=>{w(t=>t.filter(a=>a.id!==r))},j=(r,t,a)=>{w(v=>v.map(g=>g.id===r?{...g,[t]:a}:g))},V=r=>{const t=new Map;return l.forEach(a=>{const v=a[r];if(!v)return;const g=String(v).trim(),u=g.toLowerCase();t.has(u)?(g==="IT Support"||g[0]===g[0].toUpperCase()&&t.get(u)[0]!==t.get(u)[0].toUpperCase())&&t.set(u,g):t.set(u,g)}),Array.from(t.values()).sort()},se=i.useMemo(()=>V("group"),[l]),C=i.useMemo(()=>V("section"),[l]),le=i.useMemo(()=>V("class"),[l]),T=U.filter(r=>r.selected),E=T.length+A.length>8,B=E?Is:Cs,R=i.useMemo(()=>h==="all"||!o?l:l.filter(r=>{const t=r[h];return t&&String(t).trim().toLowerCase()===o.trim().toLowerCase()}),[l,h,o]),J=i.useMemo(()=>{const r=[];for(let t=0;t<R.length;t+=B)r.push(R.slice(t,t+B));return r},[R,B]),$=async()=>{M(!0),b(0),z(0),await new Promise(r=>setTimeout(r,500));try{const r=E?"landscape":"portrait",t=new Xe({orientation:r,unit:"mm",format:"a4"}),a=document.querySelectorAll(".printable-page");if(a.length===0){_({type:"error",message:"No pages found to print."}),M(!1);return}const v=a.length;for(let g=0;g<v;g++){z(g+1);const u=a[g],P=E?1555:1100,Y=E?1100:1555,re=(await Je(u,{scale:2,useCORS:!0,logging:!1,windowWidth:P,width:P,windowHeight:Y,height:Y,backgroundColor:"#ffffff"})).toDataURL("image/jpeg",.95),I=E?297:210,Z=E?210:297;g>0&&t.addPage(),t.addImage(re,"JPEG",0,0,I,Z);const xe=Math.round((g+1)/v*100);b(xe)}t.save(`${x.replace(/\s+/g,"_")}_${new Date().toISOString().slice(0,10)}.pdf`),_({type:"success",message:"PDF Downloaded Successfully!"}),setTimeout(()=>{M(!1)},800)}catch(r){console.error("PDF Generation Error:",r),_({type:"error",message:"Failed to generate PDF."}),M(!1)}};if(!s)return null;const te=new Date().toLocaleDateString("en-GB");return e.jsxs(e.Fragment,{children:[p&&e.jsxs("div",{className:`fixed top-6 right-6 z-[300] px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-4 animate-in slide-in-from-top-10 fade-in duration-300 border ${p.type==="success"?"bg-emerald-500 border-emerald-400 text-white":"bg-red-500 border-red-400 text-white"}`,children:[e.jsx("div",{className:"p-2 bg-white/20 rounded-full",children:p.type==="success"?e.jsx(ve,{className:"h-6 w-6"}):e.jsx(We,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-lg",children:p.type==="success"?"Success":"Error"}),e.jsx("p",{className:"text-sm font-medium opacity-90",children:p.message})]})]}),m&&e.jsx("div",{className:"fixed inset-0 z-[200] bg-slate-900/80 backdrop-blur-md flex flex-col items-center justify-center animate-in fade-in duration-300",children:e.jsxs("div",{className:"bg-slate-800 p-8 rounded-3xl shadow-2xl border border-slate-700 w-full max-w-md text-center",children:[e.jsxs("div",{className:"relative mb-6",children:[e.jsx("div",{className:"h-20 w-20 border-4 border-slate-600 rounded-full mx-auto"}),e.jsx("div",{className:"h-20 w-20 border-4 border-indigo-500 border-t-transparent rounded-full mx-auto absolute top-0 left-0 right-0 animate-spin"}),e.jsxs("div",{className:"absolute inset-0 flex items-center justify-center font-bold text-white text-lg",children:[D,"%"]})]}),e.jsx("h3",{className:"text-xl font-bold text-white mb-2",children:"Generating PDF..."}),e.jsxs("p",{className:"text-slate-400 text-sm mb-6",children:["Processing page ",L," of ",J.length]}),e.jsx("div",{className:"w-full bg-slate-700 rounded-full h-3 overflow-hidden shadow-inner",children:e.jsx("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-500 h-full rounded-full transition-all duration-300 ease-out",style:{width:`${D}%`}})})]})}),e.jsx("div",{className:"fixed inset-0 z-[100] bg-slate-900/40 backdrop-blur-md flex items-center justify-center p-4 animate-in fade-in duration-200",children:e.jsxs("div",{className:"bg-white rounded-3xl w-full max-w-5xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] ring-1 ring-slate-900/5",children:[e.jsxs("div",{className:"px-8 py-6 border-b border-slate-100 flex justify-between items-center bg-gradient-to-r from-slate-50 to-white",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 bg-indigo-600 rounded-2xl flex items-center justify-center shadow-lg shadow-indigo-200 text-white",children:e.jsx(we,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 tracking-tight",children:"Print Settings"}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:`px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider ${E?"bg-purple-100 text-purple-700":"bg-blue-100 text-blue-700"}`,children:E?"Landscape":"Portrait"}),e.jsxs("span",{className:"text-xs text-slate-400 font-medium",children:["• ",R.length," Records • ",J.length," Pages"]})]})]})]}),e.jsx("button",{onClick:c,className:"p-2 rounded-full hover:bg-slate-100 text-slate-400 hover:text-slate-600 transition-colors",children:e.jsx(ce,{className:"h-6 w-6"})})]}),e.jsx("div",{className:"p-8 overflow-y-auto custom-scrollbar flex-1 bg-[#F8FAFC]",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-full",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("section",{children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 bg-indigo-500 rounded-full"})," Filter Scope"]}),e.jsx("div",{className:"bg-white p-1 rounded-xl border border-slate-200 shadow-sm flex",children:["all","group","section","class"].map(r=>e.jsx("button",{onClick:()=>{d(r),S("")},className:`flex-1 py-2 text-[11px] font-bold uppercase rounded-lg transition-all duration-200 ${h===r?"bg-slate-800 text-white shadow-md":"text-slate-500 hover:bg-slate-50"}`,children:r},r))}),e.jsx("div",{className:`mt-4 transition-all duration-300 ${h!=="all"?"opacity-100 translate-y-0":"opacity-0 -translate-y-2 pointer-events-none h-0"}`,children:e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:o,onChange:r=>S(r.target.value),className:"w-full p-3 pl-4 border border-slate-200 rounded-xl text-sm font-semibold bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none appearance-none shadow-sm text-slate-700",children:[e.jsxs("option",{value:"",children:["Select Specific ",h,"..."]}),h==="group"&&se.map(r=>e.jsx("option",{value:r,children:r},r)),h==="section"&&C.map(r=>e.jsx("option",{value:r,children:r},r)),h==="class"&&le.map(r=>e.jsx("option",{value:r,children:r},r))]}),e.jsx("div",{className:"absolute right-4 top-3.5 pointer-events-none text-slate-400",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]})})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex justify-between items-end mb-3",children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 bg-teal-500 rounded-full"})," Custom Columns"]}),e.jsxs("button",{onClick:f,className:"text-[10px] flex items-center gap-1 bg-teal-50 text-teal-600 px-3 py-1.5 rounded-lg font-bold hover:bg-teal-100 transition-colors border border-teal-100",children:[e.jsx(Ce,{className:"h-3 w-3"})," Add New"]})]}),e.jsxs("div",{className:"space-y-3",children:[A.length===0&&e.jsx("div",{className:"text-center py-6 border-2 border-dashed border-slate-200 rounded-xl bg-slate-50/50",children:e.jsx("p",{className:"text-[10px] text-slate-400 font-medium",children:"No custom columns added."})}),A.map(r=>e.jsxs("div",{className:"p-3 bg-white border border-slate-200 shadow-sm rounded-xl relative group hover:border-teal-300 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("input",{value:r.label,onChange:t=>j(r.id,"label",t.target.value),className:"flex-1 text-xs font-bold text-slate-700 bg-transparent border-none p-0 focus:ring-0 placeholder-slate-300",placeholder:"Header Name"}),e.jsx("button",{onClick:()=>y(r.id),className:"text-slate-300 hover:text-red-500 transition-colors",children:e.jsx(ne,{className:"h-3.5 w-3.5"})})]}),e.jsx("div",{className:"flex bg-slate-100 p-0.5 rounded-lg",children:["blank","checkbox"].map(t=>e.jsx("button",{onClick:()=>j(r.id,"type",t),className:`flex-1 py-1 text-[9px] font-bold rounded-md uppercase transition-all ${r.type===t?"bg-white text-teal-700 shadow-sm":"text-slate-400 hover:text-slate-600"}`,children:t},t))})]},r.id))]})]})]}),e.jsxs("div",{className:"lg:col-span-2 flex flex-col h-full",children:[e.jsxs("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest mb-3 flex items-center gap-2",children:[e.jsx("div",{className:"w-1 h-1 bg-indigo-500 rounded-full"})," Visible Data Columns"]}),e.jsxs("div",{className:"bg-white p-5 rounded-2xl border border-slate-200 shadow-sm flex-1 overflow-hidden flex flex-col",children:[e.jsx("div",{className:"overflow-y-auto custom-scrollbar pr-2 pb-2",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:U.map(r=>e.jsxs("div",{onClick:()=>O(r.key),className:`
                                                        cursor-pointer select-none relative p-3 rounded-xl border transition-all duration-200 flex items-center justify-between group
                                                        ${r.selected?"bg-indigo-50 border-indigo-200 shadow-sm":"bg-slate-50 border-transparent hover:border-slate-200 hover:bg-slate-100"}
                                                    `,children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:`text-[10px] font-bold uppercase tracking-wider mb-0.5 ${r.selected?"text-indigo-400":"text-slate-400"}`,children:r.key}),e.jsx("span",{className:`text-sm font-bold font-battambang ${r.selected?"text-indigo-900":"text-slate-500 group-hover:text-slate-700"}`,children:r.label})]}),e.jsx("div",{className:`
                                                        h-5 w-5 rounded-full flex items-center justify-center transition-colors
                                                        ${r.selected?"bg-indigo-600 text-white":"bg-slate-200 text-transparent"}
                                                    `,children:e.jsx(ve,{className:"h-3 w-3"})})]},r.key))})}),e.jsx("div",{className:"mt-4 pt-4 border-t border-slate-100 text-center",children:e.jsxs("p",{className:"text-xs text-slate-400",children:["Currently showing ",e.jsx("span",{className:"text-indigo-600 font-bold",children:T.length})," data columns + ",e.jsx("span",{className:"text-teal-600 font-bold",children:A.length})," custom columns."]})})]})]})]})}),e.jsxs("div",{className:"px-8 py-5 border-t border-slate-100 bg-white flex justify-between items-center",children:[e.jsxs("div",{className:"text-xs text-slate-400 font-medium",children:["Paper Size: ",e.jsx("span",{className:"text-slate-700 font-bold",children:"A4"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:c,disabled:m,className:"px-6 py-2.5 rounded-xl font-bold text-slate-500 hover:bg-slate-100 text-sm transition-colors",children:"Cancel"}),e.jsxs("button",{onClick:$,disabled:R.length===0||m,className:"px-8 py-2.5 bg-slate-900 hover:bg-indigo-600 text-white rounded-xl font-bold shadow-lg shadow-slate-200 hover:shadow-indigo-200 flex items-center gap-2 text-sm transform active:scale-95 transition-all disabled:opacity-50 disabled:transform-none",children:[m?e.jsx(Ge,{className:"h-4 w-4 animate-spin"}):e.jsx(we,{className:"h-4 w-4"}),m?"Processing...":"Download PDF"]})]})]})]})}),e.jsx("div",{style:{position:"absolute",top:0,left:"-9999px",width:E?"1555px":"1100px"},children:e.jsxs("div",{id:"pdf-content-area",style:{width:"100%",backgroundColor:"white"},children:[e.jsx("style",{children:`
                        @import url('https://fonts.googleapis.com/css2?family=Battambang:wght@400;700&family=Inter:wght@400;500;600;700&display=swap');
                        
                        .printable-page {
                            width: ${E?"1555px":"1100px"};
                            height: ${E?"1100px":"1555px"}; 
                            padding: 40px;
                            background: white;
                            position: relative;
                            box-sizing: border-box;
                            overflow: hidden;
                        }

                        .pdf-wrapper { font-family: 'Inter', 'Battambang', sans-serif; color: #0f172a; height: 100%; }
                        
                        .header-container {
                            display: flex; justify-content: space-between; align-items: flex-end;
                            margin-bottom: 20px; border-bottom: 2px solid #0f172a; padding-bottom: 15px;
                        }

                        .header-left { display: flex; align-items: center; gap: 15px; }
                        
                        table { 
                            width: 100%; 
                            border-collapse: collapse; 
                            border: 1px solid #cbd5e1; 
                        }
                        
                        th {
                            background-color: #f1f5f9; 
                            color: #334155; 
                            font-weight: 700;
                            text-transform: uppercase; 
                            padding: 10px 5px;
                            text-align: center;
                            font-size: 14px; 
                            border: 1px solid #cbd5e1; 
                            white-space: nowrap;
                        }

                        td {
                            padding: 8px 5px; 
                            vertical-align: middle;
                            font-size: 13px;
                            border: 1px solid #e2e8f0; 
                            text-align: center; /* Default center for text */
                            height: 100%; /* Important for flex child */
                        }

                        .custom-cell-center {
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            width: 100%;
                            height: 100%;
                            min-height: 24px; /* Ensure visual height if empty */
                        }
                        
                        tr:nth-child(even) { background-color: #f8fafc; }

                        .box-check {
                            width: 18px; height: 18px; 
                            border: 2px solid #94a3b8; 
                            border-radius: 4px; 
                            display: block; /* changed to block for flex container */
                        }
                        
                        .footer-text {
                            position: absolute; bottom: 30px; right: 40px;
                            text-align: right; font-size: 10px; color: #64748b; font-weight: bold;
                        }
                    `}),J.map((r,t)=>e.jsx("div",{className:"printable-page",children:e.jsxs("div",{className:"pdf-wrapper",children:[e.jsxs("div",{className:"header-container",children:[e.jsxs("div",{className:"header-left",children:[e.jsx("img",{src:Ss,alt:"Logo",style:{height:"50px",objectFit:"contain"}}),e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"24px",fontWeight:"800",textTransform:"uppercase",margin:0},className:"font-battambang",children:x}),e.jsx("span",{style:{fontSize:"10px",color:"#64748b"},children:"Generated by HR PRO System"})]})]}),e.jsxs("div",{style:{textAlign:"right",fontSize:"10px",color:"#64748b"},children:[e.jsxs("p",{children:["DATE: ",e.jsx("span",{style:{color:"#0f172a"},children:te})]}),o&&e.jsxs("p",{className:"uppercase",children:["FILTER: ",e.jsx("span",{style:{color:"#0f172a"},children:o})]})]})]}),e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[T.map(a=>e.jsx("th",{className:"font-battambang",children:a.label},a.key)),A.map(a=>e.jsx("th",{children:a.label},a.id))]})}),e.jsx("tbody",{children:r.map((a,v)=>{const g=t*B+v+1;return e.jsxs("tr",{children:[T.map(u=>e.jsx("td",{className:"font-battambang",children:u.key==="index"?g:a[u.key]||"-"},u.key)),A.map(u=>e.jsx("td",{children:e.jsx("div",{className:"custom-cell-center",children:u.type==="checkbox"&&e.jsx("div",{className:"box-check"})})},u.id))]},a.id||v)})})]}),e.jsxs("div",{className:"footer-text",children:["Page ",t+1]})]})},t))]})})]})}const Ls=i.memo(({employee:s,onEdit:c,onDelete:l,index:x,isSelected:h,onToggleSelect:d})=>e.jsxs("div",{className:`group relative bg-white/70 backdrop-blur-md rounded-3xl border shadow-sm hover:shadow-xl hover:-translate-y-2 transition-all duration-300 overflow-hidden flex flex-col animate-fade-in ${h?"ring-2 ring-indigo-500 border-indigo-500 bg-indigo-50/50":"border-white/60"}`,style:{animationDelay:`${x*50}ms`},onDoubleClick:c,children:[e.jsx("div",{className:"absolute top-3 left-3 z-20",children:e.jsx("input",{type:"checkbox",checked:h||!1,onChange:o=>{o.stopPropagation(),d(s.id)},className:"h-5 w-5 rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 cursor-pointer accent-indigo-600"})}),e.jsxs("div",{className:"p-6 flex flex-col items-center text-center relative",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-24 bg-gradient-to-br from-indigo-50 to-blue-50 z-0"}),e.jsxs("div",{className:"absolute top-3 right-3 flex gap-2 opacity-0 group-hover:opacity-100 transition-all duration-300 z-10 translate-x-2 group-hover:translate-x-0",children:[e.jsx("button",{onClick:o=>{o.stopPropagation(),c()},className:"text-indigo-600 bg-white hover:bg-indigo-50 p-2 rounded-xl shadow-sm transition-colors border border-indigo-100",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx("button",{onClick:o=>{o.stopPropagation(),l()},className:"text-rose-500 bg-white hover:bg-rose-50 p-2 rounded-xl shadow-sm transition-colors border border-rose-100",children:e.jsx(ne,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"relative z-10 mt-4",children:[e.jsx("div",{className:"h-28 w-28 rounded-full border-4 border-white shadow-lg overflow-hidden mb-4 bg-white relative group-hover:ring-4 group-hover:ring-indigo-100 transition-all",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.name,className:"h-full w-full object-cover transform group-hover:scale-110 transition-transform duration-700"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center text-slate-300",children:e.jsx(pe,{className:"h-12 w-12"})})}),e.jsx("div",{className:"absolute bottom-5 right-1 h-5 w-5 bg-emerald-500 border-4 border-white rounded-full"})]}),e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-0.5",children:s.name}),e.jsx("p",{className:"text-slate-500 text-sm font-medium",children:s.latinName}),e.jsxs("div",{className:"mt-4 flex flex-wrap justify-center gap-2",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100/50 text-blue-600 rounded-lg text-xs font-bold",children:s.skill||"No Skill"}),e.jsx("span",{className:"px-3 py-1 bg-purple-100/50 text-purple-600 rounded-lg text-xs font-bold",children:s.group||"No Group"})]})]}),e.jsx("div",{className:"px-6 py-4 bg-slate-50/50 border-t border-slate-100 mt-auto backdrop-blur-sm",children:e.jsxs("div",{className:"grid grid-cols-2 gap-y-3 text-sm",children:[e.jsxs("div",{className:"text-slate-500 flex flex-col",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-400",children:"ID"}),e.jsx("span",{className:"font-semibold text-slate-700",children:s.studentId})]}),e.jsxs("div",{className:"text-slate-500 flex flex-col text-right",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-400",children:"Gender"}),e.jsx("span",{className:`font-semibold ${s.gender==="ស្រី"?"text-pink-500":"text-indigo-500"}`,children:s.gender})]}),e.jsxs("div",{className:"col-span-2 flex items-center gap-2 text-slate-500 truncate pt-2 border-t border-slate-200/50",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 rounded-full text-blue-600",children:e.jsx(cs,{className:"h-3 w-3"})}),e.jsx("span",{className:"truncate text-xs font-medium text-blue-600 hover:underline cursor-pointer",children:s.telegram||"No Telegram"})]})]})})]})),As=({toasts:s,removeToast:c})=>e.jsx("div",{className:"fixed bottom-6 right-6 z-[100] flex flex-col gap-3 pointer-events-none",children:s.map(l=>e.jsxs("div",{className:`pointer-events-auto flex items-center gap-3 px-5 py-3.5 rounded-2xl shadow-xl shadow-slate-200/50 transform transition-all animate-fade-in border ${l.type==="success"?"bg-white text-emerald-600 border-emerald-100":"bg-white text-red-600 border-red-100"}`,children:[l.type==="success"?e.jsx("div",{className:"bg-emerald-100 p-1.5 rounded-full",children:e.jsx(He,{className:"h-4 w-4"})}):e.jsx("div",{className:"bg-red-100 p-1.5 rounded-full",children:e.jsx(We,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-medium text-sm text-slate-700",children:l.message}),e.jsx("button",{onClick:()=>c(l.id),className:"opacity-60 hover:opacity-100 hover:bg-slate-100 p-1 rounded-md transition-all",children:e.jsx(ce,{className:"h-4 w-4"})})]},l.id))}),H=i.memo(({value:s,onSave:c,className:l,options:x})=>{const[h,d]=i.useState(!1),[o,S]=i.useState(s),m=i.useRef(null);i.useEffect(()=>{S(s)},[s]),i.useEffect(()=>{h&&m.current&&m.current.focus()},[h]);const M=()=>{d(!1),o!==s&&c(o)},D=b=>{const L=b.target.value;S(L),c(L),d(!1)};return h?x&&x.length>0?e.jsxs("select",{ref:m,value:o,onChange:D,onBlur:()=>d(!1),className:`w-full min-w-[100px] p-1.5 border-2 border-indigo-400 rounded-lg bg-white text-slate-900 outline-none text-sm shadow-lg animate-in fade-in zoom-in duration-200 ${l}`,children:[e.jsx("option",{value:"",disabled:!0,children:"Select..."}),!x.includes(s)&&s&&e.jsx("option",{value:s,children:s}),x.map((b,L)=>e.jsx("option",{value:b,children:b},`${b}-${L}`))]}):e.jsx("input",{ref:m,value:o,onChange:b=>S(b.target.value),onBlur:M,onKeyDown:b=>{b.key==="Enter"?m.current.blur():b.key==="Escape"&&(S(s),d(!1))},className:`w-full min-w-[80px] p-1.5 border-2 border-indigo-400 rounded-lg bg-white text-slate-900 outline-none text-sm shadow-lg animate-in fade-in zoom-in duration-200 ${l}`}):e.jsxs("div",{onClick:b=>{b.stopPropagation(),d(!0)},className:`cursor-pointer group hover:bg-indigo-50 hover:text-indigo-700 px-2 py-1.5 -mx-2 rounded-lg transition-all border border-transparent hover:border-indigo-100 min-h-[32px] flex items-center relative ${l}`,title:"Click to edit",children:[e.jsx("span",{className:"truncate w-full",children:s||e.jsx("span",{className:"text-slate-300 italic text-xs",children:"Empty"})}),e.jsx("span",{className:"absolute right-1 opacity-0 group-hover:opacity-40 text-[10px] text-indigo-400",children:"▼"})]})}),ke=i.memo(({icon:s,label:c,value:l,color:x})=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl p-6 rounded-3xl border border-white/50 shadow-[0_8px_30px_rgb(0,0,0,0.04)] flex items-center gap-5 hover:-translate-y-1 transition-transform duration-300 group",children:[e.jsx("div",{className:`p-4 rounded-2xl ${x.replace("bg-","bg-opacity-10 text-")} group-hover:scale-110 transition-transform duration-300`,children:e.jsx(s,{className:`h-8 w-8 ${x.replace("bg-","text-")}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 text-sm font-semibold tracking-wide uppercase mb-1",children:c}),e.jsx("h3",{className:"text-3xl font-extrabold text-slate-800 tracking-tight",children:l})]})]})),Ds=({isOpen:s,onClose:c,onConfirm:l,title:x,message:h,type:d="danger"})=>s?e.jsx("div",{className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-[60] flex items-center justify-center p-4 animate-fade-in",children:e.jsx("div",{className:"bg-white rounded-3xl max-w-sm w-full p-8 animate-scale-in shadow-2xl relative",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:`p-4 rounded-full mb-5 ${d==="danger"?"bg-red-50 text-red-500":"bg-blue-50 text-blue-500"}`,children:d==="danger"?e.jsx(fs,{className:"h-8 w-8"}):e.jsx(me,{className:"h-8 w-8"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:x}),e.jsx("p",{className:"text-slate-500 text-sm mb-8 leading-relaxed",children:h}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx("button",{onClick:c,className:"flex-1 py-3 rounded-xl border border-slate-200 text-slate-600 font-bold hover:bg-slate-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:l,className:`flex-1 py-3 rounded-xl text-white font-bold shadow-lg hover:shadow-xl transition-all hover:-translate-y-0.5 ${d==="danger"?"bg-red-500 hover:bg-red-600 shadow-red-500/30":"bg-blue-600 hover:bg-blue-700 shadow-blue-500/30"}`,children:d==="danger"?"Confirm":"Restore"})]})]})})}):null,de=s=>s?String(s).toLowerCase().replace(/\s+/g,""):"",F=s=>s?String(s):"",Es=["2023-2024","2024-2025","2025-2026","2026-2027"],Os=["Gen 1","Gen 2","Gen 3","Gen 4","Gen 5"],Ps=["ប្រុស","ស្រី"],zs=i.memo(({employee:s,onEdit:c,onDelete:l,onInlineUpdate:x,index:h,settings:d,isSelected:o,onToggleSelect:S})=>e.jsxs("tr",{className:`group transition-colors animate-fade-in border-b border-slate-100 last:border-0 ${o?"bg-indigo-50":"hover:bg-indigo-50/30"}`,onDoubleClick:c,children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap sticky left-0 bg-white/90 backdrop-blur-sm z-20 border-r border-slate-100",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("input",{type:"checkbox",checked:o||!1,onChange:m=>S(s.id),className:"h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500 cursor-pointer accent-indigo-600"}),e.jsxs("div",{className:"flex items-center gap-1 opacity-40 group-hover:opacity-100 transition-all transform translate-x-[-10px] group-hover:translate-x-0",children:[e.jsx("button",{onClick:m=>{m.stopPropagation(),c()},className:"text-indigo-600 hover:bg-indigo-100 p-2 rounded-lg transition-colors",children:e.jsx(Te,{className:"h-4 w-4"})}),e.jsx("button",{onClick:m=>{m.stopPropagation(),l()},className:"text-rose-500 hover:bg-rose-100 p-2 rounded-lg transition-colors",children:e.jsx(ne,{className:"h-4 w-4"})})]})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap sticky left-[88px] bg-white/90 backdrop-blur-sm z-20 border-r border-slate-100 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.05)]",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full overflow-hidden shadow-sm ring-2 ring-white",children:s.imageUrl?e.jsx("img",{className:"h-full w-full object-cover",src:s.imageUrl,alt:""}):e.jsx("div",{className:"h-full w-full bg-slate-100 flex items-center justify-center text-slate-400",children:e.jsx(pe,{className:"h-5 w-5"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("div",{className:"font-bold text-slate-800 text-sm",children:e.jsx(H,{value:s.name,onSave:m=>x(s.id,"ឈ្មោះ",m)})})})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600 font-medium",children:e.jsx(H,{value:s.latinName,onSave:m=>x(s.id,"ឈ្មោះឡាតាំង",m)})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:e.jsx(H,{value:s.gender,onSave:m=>x(s.id,"ភេទ",m),options:Ps,className:`font-semibold ${s.gender==="ស្រី"?"text-pink-500":"text-indigo-500"}`})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600 font-mono",children:e.jsx("div",{className:"bg-slate-100 px-2 py-1 rounded text-center text-xs font-bold text-slate-700",children:e.jsx(H,{value:s.studentId,onSave:m=>x(s.id,"អត្តលេខ",m)})})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600",children:e.jsx(H,{value:s.skill,onSave:m=>x(s.id,"ជំនាញ",m),options:d?.skills})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600 font-semibold text-slate-700",children:e.jsx(H,{value:s.group,onSave:m=>x(s.id,"ក្រុម",m),options:d?.groups})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600 text-[10px] text-slate-400",children:e.jsx(H,{value:s.class,onSave:m=>x(s.id,"ថ្នាក់",m),options:d?.classes})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600",children:e.jsx(H,{value:s.section,onSave:m=>x(s.id,"ផ្នែកការងារ",m),options:d?.sections})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600",children:e.jsx("div",{className:"px-2 py-1 bg-indigo-50 text-indigo-600 rounded border border-indigo-100 text-xs font-medium text-center",children:e.jsx(H,{value:s.position,onSave:m=>x(s.id,"តួនាទី",m),options:d?.positions})})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:e.jsx(H,{value:s.academicYear,onSave:m=>x(s.id,"ឆ្នាំសិក្សា",m),options:Es})}),e.jsxs("span",{className:"text-[10px] text-slate-400 flex items-center gap-1",children:["Gen: ",e.jsx(H,{value:s.generation,onSave:m=>x(s.id,"ជំនាន់",m),options:Os})]})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600",children:e.jsx(H,{value:s.dob,onSave:m=>x(s.id,"ថ្ងៃខែឆ្នាំកំណើត",m)})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600 max-w-xs truncate",title:s.pob,children:e.jsx(H,{value:s.pob,onSave:m=>x(s.id,"ទីកន្លែងកំណើត",m)})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-blue-500 cursor-pointer font-medium hover:underline",children:e.jsx(H,{value:s.telegram,onSave:m=>x(s.id,"តេឡេក្រាម",m)})}),["mon","tue","wed","thu","fri","sat","sun"].map((m,M)=>{const D=["ចន្ទ","អង្គារ៍","ពុធ","ព្រហស្បត្តិ៍","សុក្រ","សៅរ៍","អាទិត្យ"][M];return e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center border-l border-slate-100 text-sm font-medium text-slate-700 bg-slate-50/30",children:e.jsx(H,{value:s[m],onSave:b=>x(s.id,`កាលវិភាគ/${D}`,b),options:d?.schedules})},m)})]}),(s,c)=>s.employee===c.employee&&s.index===c.index&&s.settings===c.settings&&s.isSelected===c.isSelected),Fs=i.memo(({employee:s,onRestore:c,onPermanentDelete:l,index:x})=>e.jsxs("tr",{className:"group hover:bg-red-50/50 transition-colors animate-fade-in border-b border-slate-100",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap sticky left-0 bg-white/90 backdrop-blur-sm group-hover:bg-red-50/30 z-20 border-r border-slate-100",children:e.jsxs("div",{className:"flex items-center gap-2 opacity-60 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>c(s),className:"text-emerald-600 hover:bg-emerald-100 p-2 rounded-lg transition-colors",title:"ស្តារវិញ",children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>l(s.id),className:"text-red-600 hover:bg-red-100 p-2 rounded-lg transition-colors",title:"លុបជារៀងរហូត",children:e.jsx(ne,{className:"h-4 w-4"})})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 border-2 border-slate-100 rounded-full overflow-hidden opacity-70 grayscale",children:s.imageUrl?e.jsx("img",{className:"h-full w-full object-cover",src:s.imageUrl,alt:""}):e.jsx("div",{className:"h-full w-full bg-slate-100 flex items-center justify-center text-slate-400",children:e.jsx(pe,{className:"h-5 w-5"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("div",{className:"font-bold text-slate-700 text-sm",children:s.name})})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-500",children:s.latinName}),e.jsx("td",{className:"px-4 py-3 text-sm font-mono bg-slate-50 rounded text-center",children:s.studentId}),e.jsx("td",{className:"px-4 py-3 text-sm text-red-400 italic",children:"Deleted just now"})]})),Pe=({employees:s,loading:c,settings:l,isRecycleBin:x=!1,isModalOpen:h,onEdit:d,onDelete:o,onRestore:S,onPermanentDelete:m,onInlineUpdate:M,onCreate:D,onBulkDelete:b})=>{const[L,z]=i.useState(window.innerWidth<768?"grid":"list"),[p,_]=i.useState(""),[U,W]=i.useState(1),[A,w]=i.useState(new Set),[O,f]=i.useState(!1),[y,j]=i.useState(!1),[V,se]=i.useState(!1),[C,le]=i.useState(""),[T,G]=i.useState(""),[E,B]=i.useState(""),[R,J]=i.useState(""),[$,te]=i.useState({key:null,direction:"asc"}),[r,t]=i.useState(null),a=50,v=C||T||E||R;i.useEffect(()=>{const n=()=>{window.innerWidth<768&&z("grid")};return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),i.useEffect(()=>{w(new Set)},[x]);const g=i.useRef(null),u=i.useRef(!1),P=i.useRef(0),Y=i.useRef(0),K=n=>{u.current=!0,g.current&&(P.current=n.pageX-g.current.offsetLeft,Y.current=g.current.scrollLeft,g.current.classList.add("cursor-grabbing"))},re=()=>{u.current=!1,g.current&&g.current.classList.remove("cursor-grabbing")},I=()=>{u.current=!1,g.current&&g.current.classList.remove("cursor-grabbing")},Z=n=>{if(u.current&&(n.preventDefault(),g.current)){const X=(n.pageX-g.current.offsetLeft-P.current)*2;g.current.scrollLeft=Y.current-X}},xe=i.useMemo(()=>{const n=s.map(N=>N.group).filter(N=>N&&N.trim()!=="");return[...new Set(n)].sort()},[s]),Ne=i.useMemo(()=>{const n=s.map(N=>N.class).filter(N=>N&&N.trim()!=="");return[...new Set(n)].sort()},[s]),ye=i.useMemo(()=>{const n=s.map(N=>N.section).filter(N=>N&&N.trim()!=="");return[...new Set(n)].sort()},[s]),Me=i.useMemo(()=>{const n=s.map(N=>N.academicYear).filter(N=>N&&N.trim()!=="");return[...new Set(n)].sort()},[s]),ae=i.useMemo(()=>s.filter(n=>{const N=!p||de(n.name).includes(de(p))||de(n.latinName).includes(de(p))||de(n.studentId).includes(de(p)),X=!C||n.group===C,ie=!T||n.class===T,oe=!E||n.section===E,qe=!R||n.academicYear===R;return N&&X&&ie&&oe&&qe}),[s,p,C,T,E,R]),ge=i.useMemo(()=>{let n=[...ae];return $.key!==null&&n.sort((N,X)=>{const ie=N[$.key]?String(N[$.key]):"",oe=X[$.key]?String(X[$.key]):"";return $.key==="studentId"?$.direction==="asc"?ie.localeCompare(oe,void 0,{numeric:!0,sensitivity:"base"}):oe.localeCompare(ie,void 0,{numeric:!0,sensitivity:"base"}):$.key==="name"?$.direction==="asc"?ie.localeCompare(oe,"km"):oe.localeCompare(ie,"km"):$.direction==="asc"?ie.localeCompare(oe,"en",{sensitivity:"base"}):oe.localeCompare(ie,"en",{sensitivity:"base"})}),n},[ae,$]),Q=(n,N)=>{t({key:n,label:N,currentKey:$.key,currentDirection:$.direction})},Ke=(n,N,X=!1)=>{te(X?{key:null,direction:"asc"}:{key:n,direction:N}),t(null)};i.useEffect(()=>W(1),[p,C,T,E,R]);const Le=n=>{w(N=>{const X=new Set(N);return X.has(n)?X.delete(n):X.add(n),X})},Ae=()=>{A.size===ae.length&&ae.length>0?w(new Set):w(new Set(ae.map(n=>n.id)))},De=ge.slice((U-1)*a,U*a),Ee=Math.ceil(ge.length/a);return e.jsxs(e.Fragment,{children:[e.jsx(ks,{isOpen:!!r,sortData:r,onClose:()=>t(null),onConfirmSort:Ke}),e.jsx(Ms,{isOpen:V,onClose:()=>se(!1),employees:s,uniqueGroups:xe,uniqueClasses:Ne,uniqueSections:ye}),!x&&!h&&e.jsxs("div",{className:"lg:hidden fixed bottom-6 right-6 flex flex-col gap-4 z-[90]",children:[A.size>0&&e.jsxs("button",{onClick:()=>{b(Array.from(A)),w(new Set)},className:"h-14 w-14 bg-red-600 text-white rounded-full flex items-center justify-center active:scale-95 transition-transform shadow-red-500/40 shadow-xl",children:[e.jsx("span",{className:"absolute -top-1 -right-1 bg-white text-red-600 text-[10px] font-bold h-5 w-5 rounded-full flex items-center justify-center border border-red-100",children:A.size}),e.jsx(ne,{className:"h-6 w-6"})]}),e.jsx("button",{onClick:()=>se(!0),className:"h-14 w-14 bg-white text-slate-700 rounded-full shadow-2xl flex items-center justify-center border border-slate-100 transition-all duration-300 active:scale-95 hover:text-indigo-600",style:{boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.3)"},children:e.jsx(we,{className:"h-6 w-6"})}),e.jsx("button",{onClick:Ae,className:`h-14 w-14 rounded-full shadow-2xl flex items-center justify-center transition-all duration-300 ${A.size>0&&A.size===ae.length?"bg-indigo-600 text-white":"bg-white text-indigo-600 border border-indigo-100"}`,style:{boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.3)"},children:e.jsx(Be,{className:"h-6 w-6"})}),e.jsx("button",{onClick:()=>j(!0),className:`h-14 w-14 rounded-full shadow-2xl flex items-center justify-center transition-all duration-300 ${y?"bg-slate-800 text-white":"bg-white text-indigo-600 border border-indigo-100"}`,style:{boxShadow:"0 10px 25px -5px rgba(0, 0, 0, 0.3)"},children:e.jsx(fe,{className:"h-6 w-6"})}),e.jsx("button",{onClick:D,className:"h-14 w-14 bg-indigo-600 text-white rounded-full flex items-center justify-center active:scale-95 transition-transform",style:{boxShadow:"0 10px 25px -5px rgba(79, 70, 229, 0.5)"},children:e.jsx(Ce,{className:"h-7 w-7"})})]}),e.jsx("div",{className:`lg:hidden fixed inset-0 z-[100] bg-black/40 backdrop-blur-md transition-opacity duration-300 ${y?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`,onClick:()=>j(!1),children:e.jsxs("div",{className:`absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl p-5 shadow-2xl transition-transform duration-300 ${y?"translate-y-0":"translate-y-full"}`,onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-bold text-slate-700 text-lg",children:"Search & Filter"}),(p||C||T||E||R)&&e.jsxs("button",{onClick:()=>{_(""),le(""),G(""),B(""),J("")},className:"text-xs font-bold text-red-500 hover:text-red-700 flex items-center gap-1",children:[e.jsx(me,{className:"h-3 w-3"})," Reset"]}),e.jsx("button",{onClick:()=>j(!1),className:"p-2 bg-slate-100 rounded-full text-slate-500 hover:bg-slate-200",children:e.jsx(ce,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"relative w-full group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(fe,{className:"h-4 w-4 text-slate-400 group-focus-within:text-indigo-500 transition-colors"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-3 border border-slate-200 rounded-xl bg-white text-sm font-medium outline-none focus:ring-2 focus:ring-indigo-200",placeholder:"Search Name or ID...",value:p,onChange:n=>_(n.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 ml-1",children:"Group"}),e.jsxs("select",{value:C,onChange:n=>le(n.target.value),className:"w-full py-3 px-3 border border-slate-200 rounded-xl bg-slate-50 text-sm font-bold outline-none",children:[e.jsx("option",{value:"",children:"All"}),xe.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 ml-1",children:"Class"}),e.jsxs("select",{value:T,onChange:n=>G(n.target.value),className:"w-full py-3 px-3 border border-slate-200 rounded-xl bg-slate-50 text-sm font-bold outline-none",children:[e.jsx("option",{value:"",children:"All"}),Ne.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 ml-1",children:"Section"}),e.jsxs("select",{value:E,onChange:n=>B(n.target.value),className:"w-full py-3 px-3 border border-slate-200 rounded-xl bg-slate-50 text-sm font-bold outline-none",children:[e.jsx("option",{value:"",children:"All"}),ye.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-400 ml-1",children:"Year"}),e.jsxs("select",{value:R,onChange:n=>J(n.target.value),className:"w-full py-3 px-3 border border-slate-200 rounded-xl bg-slate-50 text-sm font-bold outline-none",children:[e.jsx("option",{value:"",children:"All"}),Me.map(n=>e.jsx("option",{value:n,children:n},n))]})]})]}),e.jsxs("button",{onClick:()=>j(!1),className:"w-full py-3 bg-indigo-600 text-white rounded-xl font-bold mt-2 shadow-lg shadow-indigo-200",children:["Show Results (",ae.length,")"]})]})]})}),e.jsxs("div",{className:"space-y-6 animate-fade-in relative min-h-[500px]",children:[e.jsxs("div",{className:"hidden lg:block glass-panel rounded-3xl sticky top-0 z-40 transition-all duration-300 shadow-sm border border-slate-100",children:[e.jsxs("div",{className:"p-4 flex flex-col md:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex gap-3 items-center w-full md:w-auto flex-1",children:[e.jsxs("div",{className:"relative w-full md:w-72 lg:w-96 group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(fe,{className:"h-5 w-5 text-slate-400 group-focus-within:text-indigo-500 transition-colors"})}),e.jsx("input",{type:"text",className:"block w-full pl-12 pr-4 py-3 border-none rounded-2xl bg-slate-100/50 focus:bg-white ring-1 ring-transparent focus:ring-slate-200 outline-none transition-all placeholder:text-slate-400 font-bold text-sm text-slate-700 shadow-inner",placeholder:"Search by Name or ID...",value:p,onChange:n=>_(n.target.value)})]}),e.jsxs("button",{onClick:()=>f(!O),className:`
                                    p-3 rounded-2xl transition-all duration-200 flex-shrink-0 border relative
                                    ${O||v?"bg-indigo-600 text-white border-indigo-500 shadow-md shadow-indigo-200":"bg-white text-slate-500 border-slate-200 hover:bg-slate-50"}
                                `,title:"Toggle Filters",children:[e.jsx(os,{className:"h-5 w-5"}),v&&!O&&e.jsx("span",{className:"absolute top-2 right-2 h-2 w-2 bg-red-400 rounded-full border border-indigo-600"})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:!x&&e.jsxs(e.Fragment,{children:[A.size>0?e.jsxs("div",{className:"flex items-center gap-3 bg-indigo-50 border border-indigo-100 px-4 py-2 rounded-2xl animate-fade-in",children:[e.jsxs("span",{className:"text-sm font-bold text-indigo-700",children:[A.size," Selected"]}),e.jsxs("button",{onClick:()=>{b(Array.from(A)),w(new Set)},className:"flex items-center gap-2 bg-white text-red-600 px-3 py-1.5 rounded-xl text-sm font-bold border border-red-100 hover:bg-red-50 transition-colors",children:[e.jsx(ne,{className:"h-4 w-4"})," Delete"]}),e.jsx("button",{onClick:()=>w(new Set),className:"text-slate-400 hover:text-slate-600",children:e.jsx(ce,{className:"h-4 w-4"})})]}):e.jsxs("div",{className:"bg-white/50 p-1.5 rounded-xl flex items-center ring-1 ring-slate-200",children:[e.jsx("button",{onClick:()=>z("grid"),className:`p-2.5 rounded-lg transition-all ${L==="grid"?"bg-white text-indigo-600 shadow-md":"text-slate-400 hover:text-slate-600"}`,children:e.jsx(_e,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>z("list"),className:`p-2.5 rounded-lg transition-all ${L==="list"?"bg-white text-indigo-600 shadow-md":"text-slate-400 hover:text-slate-600"}`,children:e.jsx(xs,{className:"h-5 w-5"})}),e.jsx("div",{className:"w-px h-6 bg-slate-200 mx-1"}),e.jsx("button",{onClick:()=>se(!0),className:"p-2.5 rounded-lg text-indigo-600 hover:bg-indigo-50 transition-all",title:"Export PDF",children:e.jsx(we,{className:"h-5 w-5"})})]}),e.jsxs("button",{onClick:D,className:"flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-2xl font-bold shadow-lg shadow-indigo-200 hover:-translate-y-1 transition-all",children:[e.jsx(Ce,{className:"h-5 w-5"})," New"]})]})})]}),e.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-in-out border-t border-slate-100 bg-slate-50/50 ${O?"max-h-[500px] opacity-100 py-4":"max-h-0 opacity-0 py-0"}`,children:e.jsxs("div",{className:"px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsx("h3",{className:"text-xs font-bold text-slate-400 uppercase tracking-widest",children:"Filter By Options"}),(C||T||E||R)&&e.jsxs("button",{onClick:()=>{le(""),G(""),B(""),J("")},className:"text-xs font-bold text-red-500 hover:text-red-700 flex items-center gap-1",children:[e.jsx(me,{className:"h-3 w-3"})," Reset"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 ml-1",children:"GROUP"}),e.jsxs("select",{value:C,onChange:n=>le(n.target.value),className:"w-full py-2.5 px-3 rounded-xl border border-slate-200 bg-white text-sm font-semibold outline-none focus:ring-2 focus:ring-indigo-500 cursor-pointer hover:border-indigo-300",children:[e.jsx("option",{value:"",children:"All Groups"}),xe.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 ml-1",children:"CLASS"}),e.jsxs("select",{value:T,onChange:n=>G(n.target.value),className:"w-full py-2.5 px-3 rounded-xl border border-slate-200 bg-white text-sm font-semibold outline-none focus:ring-2 focus:ring-indigo-500 cursor-pointer hover:border-indigo-300",children:[e.jsx("option",{value:"",children:"All Classes"}),Ne.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 ml-1",children:"SECTION"}),e.jsxs("select",{value:E,onChange:n=>B(n.target.value),className:"w-full py-2.5 px-3 rounded-xl border border-slate-200 bg-white text-sm font-semibold outline-none focus:ring-2 focus:ring-indigo-500 cursor-pointer hover:border-indigo-300",children:[e.jsx("option",{value:"",children:"All Sections"}),ye.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 ml-1",children:"YEAR"}),e.jsxs("select",{value:R,onChange:n=>J(n.target.value),className:"w-full py-2.5 px-3 rounded-xl border border-slate-200 bg-white text-sm font-semibold outline-none focus:ring-2 focus:ring-indigo-500 cursor-pointer hover:border-indigo-300",children:[e.jsx("option",{value:"",children:"All Years"}),Me.map(n=>e.jsx("option",{value:n,children:n},n))]})]})]})]})})]}),c?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 animate-pulse",children:[1,2,3].map(n=>e.jsx("div",{className:"bg-white/50 h-64 rounded-3xl"},n))}):ae.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 bg-white/40 rounded-3xl border-2 border-dashed border-slate-300",children:[e.jsx("div",{className:"bg-slate-100 p-6 rounded-full mb-4 text-slate-400",children:x?e.jsx(ne,{className:"h-10 w-10"}):e.jsx(fe,{className:"h-10 w-10"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-700",children:"មិនមានទិន្នន័យ"})]}):e.jsx(e.Fragment,{children:L==="grid"&&!x?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:De.map((n,N)=>e.jsx(Ls,{employee:n,onEdit:()=>d(n),onDelete:()=>o(n.id),index:N,isSelected:A.has(n.id),onToggleSelect:Le},n.id))}),e.jsx(Oe,{className:"glass-panel p-4 rounded-2xl flex flex-col md:flex-row justify-between items-center bg-white/80 mt-6",currentPage:U,totalPages:Ee,totalItems:ge.length,itemsPerPage:a,onPageChange:W})]}):e.jsxs("div",{className:"glass-panel rounded-3xl overflow-hidden pb-0 bg-white/80",children:[e.jsx("div",{ref:g,className:"overflow-x-auto cursor-grab active:cursor-grabbing custom-scrollbar",onMouseDown:K,onMouseLeave:re,onMouseUp:I,onMouseMove:Z,children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100",children:[e.jsx("thead",{className:"bg-slate-50/80 backdrop-blur-md",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-xs font-extrabold text-slate-500 uppercase tracking-wider sticky left-0 bg-slate-50 z-30 shadow-[4px_0_10px_-4px_rgba(0,0,0,0.05)]",children:x?"Action":e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:A.size>0&&A.size===ae.length,onChange:Ae,className:"h-4 w-4 rounded border-slate-300 text-indigo-600 focus:ring-indigo-500 cursor-pointer accent-indigo-600"}),e.jsx("span",{children:"Action"})]})}),e.jsx(ee,{label:"Name / Profile",sortKey:"name",currentSort:$,onOpenSort:Q,className:"px-0 py-0 sticky left-[88px] bg-slate-50 z-30 shadow-[4px_0_10px_-4px_rgba(0,0,0,0.05)]"}),e.jsx(ee,{label:"Latin Name",sortKey:"latinName",currentSort:$,onOpenSort:Q}),x?e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-4 text-left text-xs font-bold text-slate-500 uppercase",children:"ID"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-bold text-slate-500 uppercase",children:"Status"})]}):e.jsxs(e.Fragment,{children:[e.jsx(ee,{label:"Gender",sortKey:"gender",currentSort:$,onOpenSort:Q,className:"min-w-[100px]"}),e.jsx(ee,{label:"ID",sortKey:"studentId",currentSort:$,onOpenSort:Q,className:"min-w-[120px]"}),e.jsx(ee,{label:"Skill",sortKey:"skill",currentSort:$,onOpenSort:Q,className:"min-w-[150px]"}),e.jsx(ee,{label:"Group",sortKey:"group",currentSort:$,onOpenSort:Q,className:"min-w-[100px]"}),e.jsx(ee,{label:"Class",sortKey:"class",currentSort:$,onOpenSort:Q,className:"min-w-[100px]"}),e.jsx(ee,{label:"Section",sortKey:"section",currentSort:$,onOpenSort:Q,className:"min-w-[150px]"}),e.jsx(ee,{label:"Position",sortKey:"position",currentSort:$,onOpenSort:Q,className:"min-w-[150px]"}),e.jsx(ee,{label:"Academic",sortKey:"academicYear",currentSort:$,onOpenSort:Q,className:"min-w-[150px]"}),e.jsx(ee,{label:"DOB",sortKey:"dob",currentSort:$,onOpenSort:Q,className:"min-w-[120px]"}),e.jsx(ee,{label:"POB",sortKey:"pob",currentSort:$,onOpenSort:Q,className:"min-w-[150px]"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-extrabold text-slate-500 uppercase tracking-wider min-w-[150px]",children:"Telegram"}),["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(n=>e.jsx("th",{className:"px-4 py-4 text-center text-xs font-extrabold text-slate-500 uppercase border-l border-slate-200/50 min-w-[100px] bg-slate-100/30",children:n},n))]})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:De.map((n,N)=>x?e.jsx(Fs,{employee:n,onRestore:S,onPermanentDelete:m,index:N},n.id):e.jsx(zs,{employee:n,onEdit:()=>d(n),onDelete:()=>o(n.id),onInlineUpdate:M,index:N,settings:l,isSelected:A.has(n.id),onToggleSelect:Le},n.id))})]})}),e.jsx(Oe,{className:"flex flex-col md:flex-row justify-between items-center px-6 py-4 border-t border-slate-100 bg-slate-50/50",currentPage:U,totalPages:Ee,totalItems:ge.length,itemsPerPage:a,onPageChange:W})]})})]})]})},Rs=["2023-2024","2024-2025","2025-2026","2026-2027","ឆ្នាំទី១","ឆ្នាំទី២","ឆ្នាំទី៣","ឆ្នាំទី៤"],Gs=["Gen 1","Gen 2","Gen 3","Gen 4","Gen 5","Gen 6","ទី១","ទី២","ទី៣","ទី៤","ទី៥","ទី៦"],Ts="dsruankj0",Ys="staff_app";function _s({isOpen:s,onClose:c,employee:l,db:x,addToast:h,settings:d}){const[o,S]=i.useState({name:"",latinName:"",gender:"ប្រុស",dob:"",pob:"",studentId:"",academicYear:"",generation:"",group:"",class:"",skill:"",section:"",position:"",telegram:"",imageUrl:"",mon:"",tue:"",wed:"",thu:"",fri:"",sat:"",sun:""}),[m,M]=i.useState(!1),[D,b]=i.useState(""),[L,z]=i.useState(null);i.useEffect(()=>{s&&(l?(console.log("Editing Employee Data:",l),S({name:l.name||"",latinName:l.latinName||"",gender:l.gender||"ប្រុស",dob:l.dob||"",pob:l.pob||"",studentId:l.studentId||"",academicYear:l.academicYear||"",generation:l.generation||"",group:l.group||"",class:l.class||"",skill:l.skill||"",section:l.section||"",position:l.position||"",telegram:l.telegram||"",imageUrl:l.imageUrl||"",mon:l.mon||"",tue:l.tue||"",wed:l.wed||"",thu:l.thu||"",fri:l.fri||"",sat:l.sat||"",sun:l.sun||""}),b(l.imageUrl||""),z(null)):(b(""),z(null),S({name:"",latinName:"",gender:"ប្រុស",dob:"",pob:"",studentId:"",academicYear:"",generation:"",group:"",class:"",skill:"",section:"",position:"",telegram:"",imageUrl:"",mon:"",tue:"",wed:"",thu:"",fri:"",sat:"",sun:""})))},[s,l]);const p=O=>{const{name:f,value:y}=O.target;if(!(f==="name"&&/[^ \u1780-\u17FF]/.test(y))){if(f==="latinName"){if(/[^a-zA-Z\s]/.test(y))return;S(j=>({...j,[f]:y.toUpperCase()}));return}S(j=>({...j,[f]:y}))}},_=O=>{const f=O.target.files[0];if(!f)return;if(f.size>5*1024*1024){alert("រូបភាពធំពេក! សូមជ្រើសរើសរូបភាពក្រោម 5MB");return}z(f);const y=new FileReader;y.onloadend=()=>b(y.result),y.readAsDataURL(f)},U=async O=>{const f=new FormData;f.append("file",O),f.append("upload_preset",Ys);const y=await fetch(`https://api.cloudinary.com/v1_1/${Ts}/image/upload`,{method:"POST",body:f});if(!y.ok)throw new Error("Cloudinary upload failed");return(await y.json()).secure_url},W=async O=>{O.preventDefault(),M(!0);try{if(!o.studentId||o.studentId.trim()===""){alert("សូមបញ្ចូលអត្តលេខ (ID) ជាមុនសិន!"),M(!1);return}if(o.telegram&&!/^(https?:\/\/)?(t\.me\/|telegram\.me\/)?[a-zA-Z0-9_]{5,}$/.test(o.telegram)){alert("តេឡេក្រាមត្រូវតែជា Link (ឧ. t.me/username)!"),M(!1);return}let f=o.imageUrl;if(L)try{f=await U(L)}catch{alert("បរាជ័យក្នុងការ Upload រូបភាព។"),M(!1);return}const y={ឈ្មោះ:o.name,ឈ្មោះឡាតាំង:o.latinName,ភេទ:o.gender,ថ្ងៃខែឆ្នាំកំណើត:o.dob,ទីកន្លែងកំណើត:o.pob,អត្តលេខ:o.studentId,ឆ្នាំសិក្សា:o.academicYear,ជំនាន់:o.generation,ក្រុម:o.group,ថ្នាក់:o.class,ជំនាញ:o.skill,ផ្នែកការងារ:o.section,តួនាទី:o.position,តេឡេក្រាម:o.telegram,រូបថត:f,កាលវិភាគ:{ចន្ទ:o.mon,អង្គារ៍:o.tue,ពុធ:o.wed,ព្រហស្បត្តិ៍:o.thu,សុក្រ:o.fri,សៅរ៍:o.sat,អាទិត្យ:o.sun}};if(l&&l.id)await x.ref(`students/${l.id}`).update(y),h("កែប្រែព័ត៌មានជោគជ័យ","success");else{if((await x.ref(`students/${o.studentId}`).once("value")).exists()){alert(`អត្តលេខ ${o.studentId} មានរួចហើយ!`),M(!1);return}await x.ref(`students/${o.studentId}`).set(y),h("បញ្ចូលទិន្នន័យថ្មីជោគជ័យ","success")}c()}catch(f){console.error(f),h("បរាជ័យ: "+f.message,"error")}finally{M(!1)}},A=i.useMemo(()=>o.name?.trim().length>0&&o.studentId?.trim().length>0,[o.name,o.studentId]),w=(O,f,y=[],j=!1)=>e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block tracking-wide",children:[O," ",j&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:f,value:o[f],onChange:p,className:"w-full p-3 border border-slate-200 rounded-xl bg-slate-50/50 outline-none input-modern",children:[e.jsx("option",{value:"",children:"ជ្រើសរើស..."}),o[f]&&!y.includes(o[f])&&e.jsxs("option",{value:o[f],children:[o[f]," (Current)"]}),y.map((V,se)=>e.jsx("option",{value:V,children:V},se))]})]});return s?e.jsx("div",{className:"fixed inset-0 z-[100] bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"relative bg-white rounded-3xl w-full max-w-5xl shadow-2xl overflow-hidden flex flex-col max-h-[95vh] border border-white animate-scale-in",children:[e.jsxs("div",{className:"px-8 py-5 border-b border-slate-100 flex justify-between items-center bg-white/50 shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 tracking-tight",children:l?"កែប្រែព័ត៌មាន":"បញ្ចូលបុគ្គលិកថ្មី"}),e.jsx("p",{className:"text-sm text-slate-500 font-medium",children:"សូមបំពេញព័ត៌មានឱ្យបានត្រឹមត្រូវ"})]}),e.jsx("button",{onClick:c,className:"p-2 rounded-full hover:bg-slate-200 transition-colors",children:e.jsx(ce,{className:"h-6 w-6 text-slate-500"})})]}),e.jsxs("form",{onSubmit:W,className:"p-8 overflow-y-auto grow custom-scrollbar bg-slate-50/30",children:[e.jsxs("div",{className:"flex gap-10 flex-col lg:flex-row mb-8",children:[e.jsxs("div",{className:"flex flex-col items-center gap-6 lg:w-1/4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"h-48 w-48 rounded-3xl border-4 border-white overflow-hidden bg-white shadow-xl rotate-3 group-hover:rotate-0 transition-all duration-500",children:D?e.jsx("img",{src:D,className:"h-full w-full object-cover",alt:"Preview"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center text-slate-300",children:e.jsx(ws,{className:"h-16 w-16"})})}),e.jsxs("label",{className:"absolute -bottom-2 -right-2 bg-indigo-600 p-3.5 rounded-2xl text-white cursor-pointer shadow-lg hover:bg-indigo-700 hover:scale-110 transition-all ring-4 ring-white",children:[e.jsx(ds,{className:"h-5 w-5"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:_})]})]}),e.jsxs("div",{className:"w-full mt-4",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block text-center",children:["លេខសម្គាល់ (ID) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{name:"studentId",value:o.studentId,onChange:p,disabled:!!l,className:`w-full p-4 border-slate-200 rounded-2xl bg-white focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all text-center font-mono font-bold text-xl text-indigo-600 tracking-widest shadow-sm input-modern ${l?"opacity-70 cursor-not-allowed":""}`,placeholder:"ID..."})]})]}),e.jsxs("div",{className:"flex-1 space-y-8",children:[e.jsxs("div",{className:"bg-white/60 p-6 rounded-3xl border border-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 pb-2 border-b border-slate-100",children:[e.jsx(pe,{className:"h-5 w-5 text-indigo-500"}),e.jsx("h3",{className:"font-bold text-slate-800",children:"ព័ត៌មានផ្ទាល់ខ្លួន"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:["ឈ្មោះ (ខ្មែរ) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{name:"name",value:o.name,onChange:p,required:!0,className:"w-full p-3 border border-slate-200 rounded-xl bg-slate-50/50 outline-none input-modern"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:["ឈ្មោះ (ឡាតាំង) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{name:"latinName",value:o.latinName,onChange:p,className:"w-full p-3 border border-slate-200 rounded-xl bg-slate-50/50 outline-none input-modern"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:"ភេទ"}),e.jsxs("select",{name:"gender",value:o.gender,onChange:p,className:"w-full p-3 border border-slate-200 rounded-xl bg-slate-50/50 outline-none input-modern",children:[e.jsx("option",{value:"ប្រុស",children:"ប្រុស"}),e.jsx("option",{value:"ស្រី",children:"ស្រី"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:"ថ្ងៃកំណើត"}),e.jsx("input",{name:"dob",value:o.dob,onChange:p,placeholder:"DD/MM/YYYY",className:"w-full p-3 border border-slate-200 rounded-xl bg-slate-50/50 outline-none input-modern"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:"ទីកន្លែងកំណើត"}),e.jsx("input",{name:"pob",value:o.pob,onChange:p,className:"w-full p-3 border border-slate-200 rounded-xl bg-slate-50/50 outline-none input-modern"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:"តេឡេក្រាម Link"}),e.jsx("input",{name:"telegram",value:o.telegram,onChange:p,className:"w-full p-3 border border-slate-200 rounded-xl bg-slate-50/50 outline-none input-modern text-blue-600"})]})]})]}),e.jsxs("div",{className:"bg-white/60 p-6 rounded-3xl border border-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 pb-2 border-b border-slate-100",children:[e.jsx(ms,{className:"h-5 w-5 text-purple-500"}),e.jsx("h3",{className:"font-bold text-slate-800",children:"ការសិក្សា & ការងារ"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5",children:[w("ជំនាញ","skill",d?.skills),w("ឆ្នាំសិក្សា","academicYear",Rs),w("ជំនាន់","generation",Gs),w("ក្រុម","group",d?.groups),w("ថ្នាក់","class",d?.classes,!0),w("ផ្នែក","section",d?.sections),e.jsx("div",{className:"md:col-span-2",children:w("តួនាទី","position",d?.positions)})]})]})]})]}),e.jsxs("div",{className:"bg-white/60 p-6 rounded-3xl border border-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 pb-2 border-b border-slate-100",children:[e.jsx(ps,{className:"h-5 w-5 text-orange-500"}),e.jsx("h3",{className:"font-bold text-slate-800",children:"កាលវិភាគប្រចាំសប្តាហ៍"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-4",children:["mon","tue","wed","thu","fri","sat","sun"].map((O,f)=>e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-wider text-center",children:["ចន្ទ","អង្គារ៍","ពុធ","ព្រហ","សុក្រ","សៅរ៍","អាទិត្យ"][f]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{name:O,value:o[O],onChange:p,className:"w-full py-3 pl-3 pr-8 border border-slate-200 rounded-xl bg-white text-xs font-bold text-slate-700 outline-none focus:ring-2 focus:ring-indigo-500/20 appearance-none cursor-pointer transition-all shadow-sm hover:border-indigo-300",children:[e.jsx("option",{value:"",children:"-"}),d?.schedules&&d.schedules.map(y=>e.jsx("option",{value:y,children:y},y))]}),e.jsx("div",{className:"absolute inset-y-0 right-2.5 flex items-center pointer-events-none text-slate-400",children:e.jsx(is,{className:"h-3.5 w-3.5"})})]})]},O))})]})]}),e.jsxs("div",{className:"px-8 py-5 bg-white border-t border-slate-100 flex justify-end gap-4 shrink-0",children:[e.jsx("button",{onClick:c,className:"px-8 py-3 rounded-xl text-slate-600 font-semibold hover:bg-slate-100 transition-colors",children:"បោះបង់"}),e.jsxs("button",{onClick:W,disabled:m||!A,className:"px-10 py-3 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold shadow-lg shadow-indigo-200 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed transform hover:-translate-y-1 transition-all",children:[m?e.jsx(Ge,{className:"h-5 w-5 animate-spin"}):e.jsx(He,{className:"h-5 w-5"})," ",l?"កែប្រែ":"រក្សាទុក"]})]})]})}):null}const Us=()=>{const[s,c]=i.useState([]),l=(h,d="success")=>{const o=Date.now();c(S=>[...S,{id:o,message:h,type:d}]),setTimeout(()=>x(o),3e3)},x=h=>c(d=>d.filter(o=>o.id!==h));return{toasts:s,addToast:l,removeToast:x}};function Vs({stats:s,onNavigate:c}){return e.jsxs("div",{className:"space-y-8 animate-fade-in max-w-7xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(ke,{icon:Ue,label:"Total Employees",value:s.total,color:"bg-blue-500"}),e.jsx(ke,{icon:hs,label:"Male Staff",value:s.male,color:"bg-indigo-500"}),e.jsx(ke,{icon:us,label:"Female Staff",value:s.female,color:"bg-pink-500"})]}),e.jsxs("div",{className:"glass-panel rounded-3xl p-10 flex flex-col items-center justify-center text-center min-h-[400px]",children:[e.jsx("div",{className:"bg-indigo-50 p-6 rounded-full mb-6 animate-scale-in",children:e.jsx(js,{className:"h-16 w-16 text-indigo-500"})}),e.jsx("h2",{className:"text-3xl font-extrabold text-slate-800 mb-3",children:"Welcome to HR System Pro"}),e.jsx("p",{className:"text-slate-500 max-w-lg text-lg mb-8",children:"គ្រប់គ្រងទិន្នន័យបុគ្គលិករបស់អ្នកដោយងាយស្រួល និងមានប្រសិទ្ធភាពខ្ពស់។"}),e.jsx("button",{onClick:()=>c("employees"),className:"px-8 py-3 bg-indigo-600 text-white rounded-2xl font-bold hover:bg-indigo-700 shadow-xl shadow-indigo-300 hover:-translate-y-1 transition-all",children:"ចាប់ផ្តើមគ្រប់គ្រង"})]})]})}function Bs({db:s,settings:c,setConfirmDialog:l,addToast:x}){const[h,d]=i.useState("skills"),[o,S]=i.useState(""),m=[{id:"skills",label:"ជំនាញ (Skills)"},{id:"groups",label:"ក្រុម (Groups)"},{id:"classes",label:"ថ្នាក់ (Classes)"},{id:"sections",label:"ផ្នែក (Sections)"},{id:"positions",label:"តួនាទី (Positions)"},{id:"schedules",label:"កាលវិភាគ (Schedules)"}],M=async b=>{if(b&&b.preventDefault(),!!o.trim())try{const L=c?.[h]||[];if(L.includes(o)){x("មានរួចហើយ!","error");return}await s.ref(`settings/${h}`).set([...L,o]),S(""),x("បានបន្ថែមជោគជ័យ")}catch(L){console.error(L),x("បរាជ័យ","error")}},D=b=>{l({isOpen:!0,type:"danger",title:"លុបការកំណត់",message:`តើអ្នកពិតជាចង់លុប "${b}" ចេញពីបញ្ជីមែនទេ?`,onConfirm:async()=>{try{const L=c?.[h]||[];await s.ref(`settings/${h}`).set(L.filter(z=>z!==b)),l(z=>({...z,isOpen:!1})),x("បានលុបជោគជ័យ")}catch(L){console.error(L),x("បរាជ័យ","error")}}})};return e.jsxs("div",{className:"animate-fade-in space-y-6",children:[e.jsxs("h2",{className:"text-2xl md:text-3xl font-extrabold text-slate-800 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-xl text-blue-600",children:e.jsx(Ve,{className:"h-6 w-6"})}),"ការកំណត់ Dropdown"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 md:gap-8",children:[e.jsx("div",{className:"glass-panel rounded-3xl p-4 h-fit",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-1 gap-2 md:space-y-2",children:m.map(b=>e.jsxs("button",{onClick:()=>d(b.id),className:`w-full text-left px-3 py-3 md:px-5 md:py-3.5 rounded-xl md:rounded-2xl font-bold transition-all duration-300 flex justify-between items-center text-sm md:text-base ${h===b.id?"bg-indigo-600 text-white shadow-lg shadow-indigo-300 transform scale-105":"text-slate-500 hover:bg-white hover:text-slate-800"}`,children:[e.jsx("span",{className:"truncate",children:b.label}),h===b.id&&e.jsx("div",{className:"hidden md:block h-2 w-2 bg-white rounded-full animate-pulse shrink-0"})]},b.id))})}),e.jsxs("div",{className:"md:col-span-3 glass-panel rounded-3xl p-5 md:p-8 min-h-[500px]",children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-700 mb-6 border-b border-slate-200/50 pb-4",children:[m.find(b=>b.id===h)?.label," List"]}),e.jsxs("form",{onSubmit:M,className:"flex flex-col sm:flex-row gap-3 mb-8",children:[e.jsx("input",{value:o,onChange:b=>S(b.target.value),placeholder:"បញ្ចូលឈ្មោះថ្មី...",className:"flex-1 px-5 py-3 border border-slate-200 rounded-2xl focus:ring-4 focus:ring-indigo-100 outline-none shadow-sm input-modern w-full"}),e.jsx("button",{type:"submit",className:"px-8 py-3 bg-indigo-600 text-white rounded-2xl hover:bg-indigo-700 font-bold shadow-lg shadow-indigo-200 transition-all hover:-translate-y-1 w-full sm:w-auto",children:"បន្ថែម"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:c?.[h]?.map((b,L)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white border border-slate-100 rounded-2xl group hover:border-indigo-200 hover:shadow-md transition-all",children:[e.jsx("span",{className:"font-semibold text-slate-700 break-words",children:b}),e.jsx("button",{type:"button",onClick:()=>D(b),className:"p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors shrink-0 cursor-pointer",children:e.jsx(ne,{className:"h-4 w-4"})})]},L))})]})]})]})}const Hs=["ឆ្នាំទី១","ឆ្នាំទី២","ឆ្នាំទី៣","ឆ្នាំទី៤"],Ws=s=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("line",{x1:"21",y1:"21",x2:"16.65",y2:"16.65"})]}),Ks=s=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:e.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),qs=s=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:e.jsx("polyline",{points:"6 9 12 15 18 9"})}),ze=s=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),Zs=s=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:e.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),Xs=s=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[e.jsx("rect",{x:"2",y:"7",width:"20",height:"14",rx:"2",ry:"2"}),e.jsx("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})]}),Fe=s=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e.jsx("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e.jsx("line",{x1:"3",y1:"10",x2:"21",y2:"10"})]}),Se=s=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[e.jsx("path",{d:"M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),Js=s=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[e.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),Qs=s=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[e.jsx("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),e.jsx("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]}),et=s=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[e.jsx("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),st=({searchTerm:s,setSearchTerm:c,filterClass:l,setFilterClass:x,filterYear:h,setFilterYear:d,filterGroup:o,setFilterGroup:S,filterSection:m,setFilterSection:M,uniqueClasses:D,uniqueYears:b,uniqueGroups:L,uniqueSections:z})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"relative w-full md:w-64 group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ws,{className:"h-4 w-4 text-slate-400 group-focus-within:text-indigo-500 transition-colors"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2.5 border border-slate-200 rounded-xl bg-white text-sm font-medium outline-none focus:ring-2 focus:ring-indigo-200 transition-all placeholder:text-slate-400",placeholder:"ស្វែងរក...",value:s,onChange:p=>c(p.target.value)})]}),e.jsxs("div",{className:"flex gap-3 w-full md:w-auto overflow-x-auto pb-1 md:pb-0",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-indigo-50/50 rounded-xl border border-indigo-100 whitespace-nowrap",children:[e.jsx(Ks,{className:"h-4 w-4 text-indigo-500"}),e.jsx("span",{className:"text-xs font-bold text-indigo-600",children:"Filter:"})]}),e.jsxs("select",{value:o,onChange:p=>S(p.target.value),className:"py-2.5 px-4 rounded-xl border border-slate-200 bg-white text-sm font-medium outline-none focus:ring-2 focus:ring-indigo-200 min-w-[120px]",children:[e.jsx("option",{value:"",children:"គ្រប់ក្រុម"}),L.map(p=>e.jsx("option",{value:p,children:p},p))]}),e.jsxs("select",{value:l,onChange:p=>x(p.target.value),className:"py-2.5 px-4 rounded-xl border border-slate-200 bg-white text-sm font-medium outline-none focus:ring-2 focus:ring-indigo-200 min-w-[120px]",children:[e.jsx("option",{value:"",children:"គ្រប់ថ្នាក់"}),D.map(p=>e.jsx("option",{value:p,children:p},p))]}),e.jsxs("select",{value:m,onChange:p=>M(p.target.value),className:"py-2.5 px-4 rounded-xl border border-slate-200 bg-white text-sm font-medium outline-none focus:ring-2 focus:ring-indigo-200 min-w-[120px]",children:[e.jsx("option",{value:"",children:"គ្រប់ផ្នែក"}),z.map(p=>e.jsx("option",{value:p,children:p},p))]}),e.jsxs("select",{value:h,onChange:p=>d(p.target.value),className:"py-2.5 px-4 rounded-xl border border-slate-200 bg-white text-sm font-medium outline-none focus:ring-2 focus:ring-indigo-200 min-w-[120px]",children:[e.jsx("option",{value:"",children:"គ្រប់ឆ្នាំសិក្សា"}),b.map(p=>e.jsx("option",{value:p,children:p},p))]})]})]});function tt({db:s,employees:c,settings:l,addToast:x,setConfirmDialog:h}){const[d,o]=i.useState(new Set),[S,m]=i.useState(""),[M,D]=i.useState(""),[b,L]=i.useState(""),[z,p]=i.useState(""),[_,U]=i.useState(""),[W,A]=i.useState(!1),[w,O]=i.useState(null),[f,y]=i.useState("personal"),[j,V]=i.useState({group:"",section:"",position:"",academicYear:"",mon:"",tue:"",wed:"",thu:"",fri:"",sat:"",sun:""});i.useEffect(()=>{if(d.size===0){V({group:"",section:"",position:"",academicYear:"",mon:"",tue:"",wed:"",thu:"",fri:"",sat:"",sun:""});return}const t=c.filter(u=>d.has(u.id));if(t.length===0)return;const a=u=>u==null?"":String(u).trim(),v=["group","section","position","academicYear","mon","tue","wed","thu","fri","sat","sun"],g={};v.forEach(u=>{const P=a(t[0][u]);t.every(K=>a(K[u])===P)?g[u]=P!==""?t[0][u]:"":g[u]=""}),V(g)},[d,c]);const se=i.useMemo(()=>{const t=c.map(a=>a.class).filter(a=>a&&a.trim()!=="");return[...new Set(t)].sort()},[c]),C=i.useMemo(()=>{const t=c.map(a=>a.academicYear).filter(a=>a&&a.trim()!=="");return[...new Set(t)].sort()},[c]),le=i.useMemo(()=>{const t=c.map(a=>a.group).filter(a=>a&&a.trim()!=="");return[...new Set(t)].sort()},[c]),T=i.useMemo(()=>{const t=c.map(a=>a.section).filter(a=>a&&a.trim()!=="");return[...new Set(t)].sort()},[c]),G=i.useMemo(()=>c.filter(t=>{const a=S?t.class===S:!0,v=M?t.academicYear===M:!0,g=b?t.group===b:!0,u=z?t.section===z:!0,P=/^\d+$/.test(t.studentId||""),Y=_.toLowerCase().replace(/\s+/g,""),K=(t.name||"").toLowerCase().replace(/\s+/g,""),re=(t.latinName||"").toLowerCase().replace(/\s+/g,""),I=(t.studentId||"").toLowerCase().replace(/\s+/g,""),Z=K.includes(Y)||re.includes(Y)||I.includes(Y);return a&&v&&g&&u&&P&&Z}),[c,S,M,b,z,_]),E=t=>{if(t.target.checked){const a=new Set(G.map(v=>v.id));o(a)}else o(new Set)},B=t=>{const a=new Set(d);a.has(t)?a.delete(t):a.add(t),o(a)},R=(t,a)=>V(v=>({...v,[t]:a})),J=async()=>{A(!0),h(u=>({...u,isOpen:!1}));const t={},a={};j.group!==""&&(a.ក្រុម=j.group),j.section!==""&&(a.ផ្នែកការងារ=j.section),j.position!==""&&(a.តួនាទី=j.position),j.academicYear!==""&&(a.ឆ្នាំសិក្សា=j.academicYear);const v=["mon","tue","wed","thu","fri","sat","sun"],g=["ចន្ទ","អង្គារ៍","ពុធ","ព្រហស្បត្តិ៍","សុក្រ","សៅរ៍","អាទិត្យ"];d.forEach(u=>{Object.keys(a).forEach(P=>{t[`students/${u}/${P}`]=a[P]}),v.forEach((P,Y)=>{j[P]!==""&&(t[`students/${u}/កាលវិភាគ/${g[Y]}`]=j[P])})});try{Object.keys(t).length>0?(await s.ref().update(t),x(`បានកែប្រែទិន្នន័យជោគជ័យសម្រាប់ ${d.size} នាក់`,"success"),o(new Set),V({group:"",section:"",position:"",academicYear:"",mon:"",tue:"",wed:"",thu:"",fri:"",sat:"",sun:""})):x("សូមជ្រើសរើសទិន្នន័យដែលត្រូវកែប្រែ","warning")}catch(u){console.error(u),x("បរាជ័យក្នុងការកែប្រែ","error")}finally{A(!1)}},$=()=>{if(d.size===0){x("សូមជ្រើសរើសបុគ្គលិកជាមុនសិន","warning");return}if(!Object.values(j).some(a=>a!=="")){x("សូមជ្រើសរើសព័ត៌មានដែលត្រូវកែប្រែ","warning");return}h({isOpen:!0,type:"warning",title:"បញ្ជាក់ការកែប្រែ",message:`តើអ្នកចង់កែប្រែទិន្នន័យសម្រាប់បុគ្គលិកចំនួន ${d.size} នាក់ដែលបានជ្រើសរើសមែនទេ?`,onConfirm:J})},te=(t,a,v,g="មិនកែប្រែ (Various)")=>{const u=j[a],P=Array.isArray(v)?v:[],Y=u&&u!==""&&!P.includes(u);return e.jsxs("div",{className:"min-w-[140px]",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase mb-1 block",children:t}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:u,onChange:K=>R(a,K.target.value),className:`w-full py-2 pl-2 pr-6 border rounded-xl outline-none text-xs font-bold appearance-none transition-all ${u?"bg-indigo-50 border-indigo-300 text-indigo-700":"bg-white border-slate-200 text-slate-400"}`,children:[e.jsx("option",{value:"",children:g}),Y&&e.jsx("option",{value:u,children:u}),P.map(K=>e.jsx("option",{value:K,children:K},K))]}),e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center pointer-events-none opacity-50",children:e.jsx(qs,{className:"h-3 w-3"})})]})]})},r=t=>{const a=j[t],v=Array.isArray(l?.schedules)?l.schedules:[],g=a&&a!==""&&!v.includes(a);return e.jsxs("select",{value:a,onChange:u=>R(t,u.target.value),className:`w-full py-1.5 px-1 border rounded-lg text-xs font-bold outline-none text-center ${a?"bg-orange-50 border-orange-200 text-orange-700":"bg-white border-slate-200"}`,children:[e.jsx("option",{value:"",children:"-"}),g&&e.jsx("option",{value:a,children:a}),v.map(u=>e.jsx("option",{value:u,children:u},u))]})};return e.jsxs("div",{className:"h-full flex flex-col relative animate-fade-in",children:[e.jsxs("div",{className:"hidden md:flex glass-panel p-4 rounded-3xl flex-col xl:flex-row justify-between items-start xl:items-center gap-4 mb-4 shrink-0",children:[e.jsx("div",{className:"flex flex-col md:flex-row gap-4 w-full xl:w-auto",children:e.jsx(st,{searchTerm:_,setSearchTerm:U,filterClass:S,setFilterClass:m,filterYear:M,setFilterYear:D,filterGroup:b,setFilterGroup:L,filterSection:z,setFilterSection:p,uniqueClasses:se,uniqueYears:C,uniqueGroups:le,uniqueSections:T})}),e.jsxs("div",{className:"text-xs font-bold text-slate-500 bg-white px-3 py-1.5 rounded-lg border border-slate-200",children:["Total Found: ",e.jsx("span",{className:"text-indigo-600 text-sm",children:G.length})]})]}),e.jsxs("div",{className:"md:hidden flex justify-between items-center mb-4 px-2",children:[e.jsxs("h2",{className:"text-lg font-bold text-slate-700",children:["បុគ្គលិក (",G.length,")"]}),e.jsx("div",{className:"text-xs text-slate-500 italic",children:"Double tap for full detail"})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar pb-32 px-1 md:px-0",children:[e.jsx("div",{className:"hidden md:block glass-panel rounded-3xl overflow-hidden bg-white/80",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100",children:[e.jsx("thead",{className:"bg-slate-50/90 backdrop-blur sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left w-12",children:e.jsx("input",{type:"checkbox",onChange:E,checked:G.length>0&&d.size===G.length,className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 h-4 w-4 cursor-pointer"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-extrabold text-slate-500 uppercase",children:"Profile"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-extrabold text-slate-500 uppercase",children:"ID / Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-extrabold text-slate-500 uppercase",children:"Current Info"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100",children:[G.map(t=>e.jsxs("tr",{className:`hover:bg-indigo-50/30 transition-colors ${d.has(t.id)?"bg-indigo-50/60":""}`,onClick:()=>B(t.id),children:[e.jsx("td",{className:"px-4 py-3",onClick:a=>a.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:d.has(t.id),onChange:()=>B(t.id),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 h-4 w-4 cursor-pointer"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-10 w-10 rounded-full overflow-hidden border border-slate-200",children:t.imageUrl?e.jsx("img",{src:t.imageUrl,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full bg-slate-100 flex items-center justify-center text-slate-400",children:e.jsx(Se,{className:"h-5 w-5"})})})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-mono text-xs font-bold text-indigo-600 bg-indigo-50 px-1.5 py-0.5 rounded w-fit mb-1",children:t.studentId}),e.jsx("span",{className:"text-sm font-bold text-slate-700",children:t.name}),e.jsx("span",{className:"text-xs text-slate-400",children:t.latinName})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[e.jsx("span",{className:"bg-white border border-slate-200 px-2 py-1 rounded text-slate-600",children:t.class||"No Class"}),e.jsx("span",{className:"bg-white border border-slate-200 px-2 py-1 rounded text-slate-600",children:t.academicYear||"No Year"}),e.jsx("span",{className:"bg-white border border-slate-200 px-2 py-1 rounded text-slate-600",children:t.group||"No Group"}),e.jsx("span",{className:"bg-white border border-slate-200 px-2 py-1 rounded text-slate-600",children:t.section||"No Section"})]})})]},t.id)),G.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center py-10 text-slate-400 italic",children:"No employees found"})})]})]})}),e.jsxs("div",{className:"md:hidden grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2 px-1",children:[e.jsx("input",{type:"checkbox",id:"selectAllMobile",onChange:E,checked:G.length>0&&d.size===G.length,className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 h-4 w-4 cursor-pointer"}),e.jsx("label",{htmlFor:"selectAllMobile",className:"text-sm font-bold text-slate-600",children:"Select All"})]}),G.map(t=>e.jsxs("div",{onDoubleClick:()=>{O(t),y("personal")},onClick:()=>B(t.id),className:`glass-panel p-4 rounded-2xl border transition-all active:scale-[0.98] relative overflow-hidden ${d.has(t.id)?"border-indigo-500 bg-indigo-50/50 ring-1 ring-indigo-500":"border-transparent bg-white"}`,children:[e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("div",{className:`h-5 w-5 rounded-full border flex items-center justify-center transition-colors ${d.has(t.id)?"bg-indigo-600 border-indigo-600":"border-slate-300 bg-white"}`,children:d.has(t.id)&&e.jsx(ze,{className:"h-3.5 w-3.5 text-white"})})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-12 w-12 rounded-full overflow-hidden border border-slate-200 shrink-0",children:t.imageUrl?e.jsx("img",{src:t.imageUrl,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full bg-slate-100 flex items-center justify-center text-slate-400",children:e.jsx(Se,{className:"h-6 w-6"})})}),e.jsxs("div",{className:"flex flex-col min-w-0",children:[e.jsx("span",{className:"font-mono text-[10px] font-bold text-indigo-600 bg-indigo-50 px-1.5 py-0.5 rounded w-fit mb-0.5",children:t.studentId}),e.jsx("span",{className:"text-sm font-bold text-slate-700 truncate",children:t.name}),e.jsx("span",{className:"text-xs text-slate-400 truncate",children:t.latinName})]})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2 text-[10px]",children:[e.jsx("span",{className:"bg-slate-50 border border-slate-100 px-2 py-1 rounded-lg text-slate-600 font-medium",children:t.class||"No Class"}),e.jsx("span",{className:"bg-slate-50 border border-slate-100 px-2 py-1 rounded-lg text-slate-600 font-medium",children:t.academicYear||"No Year"}),e.jsx("span",{className:"bg-slate-50 border border-slate-100 px-2 py-1 rounded-lg text-slate-600 font-medium",children:t.group||"No Group"})]})]},t.id)),G.length===0&&e.jsx("div",{className:"text-center py-10 text-slate-400 italic col-span-full",children:"No employees found"})]})]}),e.jsxs("div",{className:`absolute bottom-0 left-0 right-0 glass-modal rounded-t-3xl border-t border-indigo-100 shadow-[0_-10px_40px_rgba(0,0,0,0.1)] transition-transform duration-300 transform z-20 ${d.size>0?"translate-y-0":"translate-y-full"}`,children:[e.jsxs("div",{className:"p-2 bg-gradient-to-r from-indigo-600 to-blue-600 text-white text-center text-xs font-bold tracking-wider rounded-t-3xl",children:["កែប្រែទិន្នន័យសម្រាប់ ",d.size," នាក់"]}),e.jsx("div",{className:"p-4 md:p-6 overflow-x-auto custom-scrollbar",children:e.jsxs("div",{className:"flex gap-6 min-w-max",children:[e.jsxs("div",{className:"flex gap-3 pr-6 border-r border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-indigo-600 font-bold text-xs whitespace-nowrap",children:[e.jsx(Xs,{className:"h-4 w-4"})," ការងារ:"]}),te("ក្រុម","group",l?.groups),te("ផ្នែក","section",l?.sections),te("តួនាទី","position",l?.positions),te("ឆ្នាំសិក្សា","academicYear",Hs)]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-500 font-bold text-xs whitespace-nowrap",children:[e.jsx(Fe,{className:"h-4 w-4"})," កាលវិភាគ:"]}),["mon","tue","wed","thu","fri","sat","sun"].map((t,a)=>e.jsxs("div",{className:"min-w-[80px]",children:[e.jsx("label",{className:"text-[9px] font-bold text-slate-400 uppercase mb-1 block text-center",children:["ចន្ទ","អង្គារ៍","ពុធ","ព្រហ","សុក្រ","សៅរ៍","អាទិត្យ"][a]}),r(t)]},t))]})]})}),e.jsx("div",{className:"p-4 border-t border-slate-100 bg-white/50 flex justify-end",children:e.jsxs("button",{onClick:$,disabled:W,className:"px-8 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold shadow-lg shadow-indigo-200 flex items-center gap-2 disabled:opacity-50 transition-all active:scale-95",children:[W?e.jsx(Zs,{className:"h-4 w-4 animate-spin"}):e.jsx(ze,{className:"h-4 w-4"})," រក្សាទុកការកែប្រែ"]})})]}),w&&e.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-slate-900/60 backdrop-blur-md p-4 animate-in fade-in zoom-in-95 duration-200",children:e.jsxs("div",{className:"bg-white w-full max-w-lg rounded-3xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] relative transform transition-all scale-100",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"relative h-32 bg-gradient-to-br from-indigo-600 to-purple-700 shrink-0",children:[e.jsx("button",{onClick:()=>O(null),className:"absolute top-4 right-4 z-10 p-2 bg-black/20 hover:bg-black/30 backdrop-blur-md rounded-full text-white transition-all",children:e.jsx(Js,{className:"h-5 w-5"})}),e.jsx("div",{className:"absolute -bottom-10 left-6",children:e.jsx("div",{className:"h-24 w-24 rounded-full border-[6px] border-white shadow-lg overflow-hidden bg-white",children:w.imageUrl?e.jsx("img",{src:w.imageUrl,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center text-slate-300",children:e.jsx(Se,{className:"h-12 w-12"})})})})]}),e.jsx("div",{className:"pt-12 px-6 pb-4 shrink-0",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 leading-tight",children:w.name}),e.jsx("p",{className:"text-slate-500 font-medium",children:w.latinName})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[e.jsx("span",{className:"px-3 py-1 bg-indigo-50 text-indigo-700 rounded-full text-xs font-mono font-bold border border-indigo-100",children:w.studentId}),e.jsx("span",{className:`text-xs font-bold px-2 py-0.5 rounded-md ${w.gender==="ស្រី"?"bg-pink-50 text-pink-600":"bg-blue-50 text-blue-600"}`,children:w.gender})]})]})}),e.jsxs("div",{className:"flex px-6 border-b border-slate-100 shrink-0 gap-6 overflow-x-auto no-scrollbar",children:[e.jsxs("button",{onClick:()=>y("personal"),className:`pb-3 text-sm font-bold transition-all relative whitespace-nowrap ${f==="personal"?"text-indigo-600":"text-slate-400 hover:text-slate-600"}`,children:["Personal",f==="personal"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-600 rounded-t-full"})]}),e.jsxs("button",{onClick:()=>y("work"),className:`pb-3 text-sm font-bold transition-all relative whitespace-nowrap ${f==="work"?"text-indigo-600":"text-slate-400 hover:text-slate-600"}`,children:["Work & Study",f==="work"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-600 rounded-t-full"})]}),e.jsxs("button",{onClick:()=>y("schedule"),className:`pb-3 text-sm font-bold transition-all relative whitespace-nowrap ${f==="schedule"?"text-indigo-600":"text-slate-400 hover:text-slate-600"}`,children:["Schedule",f==="schedule"&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-indigo-600 rounded-t-full"})]})]}),e.jsxs("div",{className:"overflow-y-auto custom-scrollbar p-6 flex-1 bg-slate-50/50",children:[f==="personal"&&e.jsx("div",{className:"space-y-4 animate-in fade-in slide-in-from-bottom-2 duration-300",children:e.jsxs("div",{className:"bg-white p-4 rounded-2xl border border-slate-100 shadow-sm space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-50 text-blue-600 rounded-lg",children:e.jsx(Fe,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase",children:"Date of Birth"}),e.jsx("p",{className:"text-sm font-semibold text-slate-700",children:w.dob||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-emerald-50 text-emerald-600 rounded-lg",children:e.jsx(et,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase",children:"Place of Birth"}),e.jsx("p",{className:"text-sm font-semibold text-slate-700 leading-relaxed",children:w.pob||"N/A"})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-sky-50 text-sky-600 rounded-lg",children:e.jsx(Qs,{className:"h-5 w-5"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase",children:"Telegram"}),e.jsx("p",{className:"text-sm font-semibold text-blue-600 cursor-pointer hover:underline",children:w.telegram||"N/A"})]})]})]})}),f==="work"&&e.jsxs("div",{className:"grid grid-cols-2 gap-3 animate-in fade-in slide-in-from-bottom-2 duration-300",children:[e.jsxs("div",{className:"col-span-2 bg-indigo-600 p-4 rounded-2xl text-white shadow-lg shadow-indigo-200 mb-2",children:[e.jsx("p",{className:"text-indigo-200 text-xs font-bold uppercase mb-1",children:"Current Position"}),e.jsx("p",{className:"text-xl font-bold",children:w.position||"N/A"})]}),e.jsxs("div",{className:"bg-white p-3 rounded-2xl border border-slate-100 shadow-sm",children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Section"}),e.jsx("p",{className:"text-sm font-bold text-slate-700",children:w.section||"-"})]}),e.jsxs("div",{className:"bg-white p-3 rounded-2xl border border-slate-100 shadow-sm",children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Group"}),e.jsx("p",{className:"text-sm font-bold text-slate-700",children:w.group||"-"})]}),e.jsxs("div",{className:"bg-white p-3 rounded-2xl border border-slate-100 shadow-sm",children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Class"}),e.jsx("p",{className:"text-sm font-bold text-slate-700",children:w.class||"-"})]}),e.jsxs("div",{className:"bg-white p-3 rounded-2xl border border-slate-100 shadow-sm",children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Generation"}),e.jsx("p",{className:"text-sm font-bold text-slate-700",children:w.generation||"-"})]}),e.jsxs("div",{className:"col-span-2 bg-white p-3 rounded-2xl border border-slate-100 shadow-sm flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase",children:"Academic Year"}),e.jsx("p",{className:"text-sm font-bold text-slate-700",children:w.academicYear||"-"})]}),e.jsx("div",{className:"px-3 py-1 bg-slate-100 rounded-lg text-xs font-bold text-slate-500",children:w.skill||"No Skill"})]})]}),f==="schedule"&&e.jsx("div",{className:"space-y-3 animate-in fade-in slide-in-from-bottom-2 duration-300",children:["mon","tue","wed","thu","fri","sat","sun"].map((t,a)=>{const v=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"][a],g=w[t],u=new Date().getDay()===(a+1)%7;return e.jsxs("div",{className:`flex items-center p-3 rounded-2xl border ${u?"bg-indigo-50 border-indigo-200 ring-1 ring-indigo-200":"bg-white border-slate-100 shadow-sm"}`,children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-xs font-bold mr-3 ${u?"bg-indigo-600 text-white":"bg-slate-100 text-slate-500"}`,children:v.substring(0,3)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:`text-xs font-bold mb-0.5 ${u?"text-indigo-600":"text-slate-400"}`,children:v}),e.jsx("p",{className:`text-sm font-medium ${g?"text-slate-800":"text-slate-300 italic"}`,children:g||"No Schedule"})]})]},t)})})]})]})})]})}function lt(){const[s,c]=i.useState(null),[l,x]=i.useState(null),[h,d]=i.useState(!1),[o,S]=i.useState(""),[m,M]=i.useState(!1),[D,b]=i.useState([]),[L,z]=i.useState([]),[p,_]=i.useState({}),[U,W]=i.useState(!0),[A,w]=i.useState(!1),[O,f]=i.useState(null),[y,j]=i.useState({isOpen:!1,title:"",message:"",onConfirm:null,type:"danger"}),V=Qe(),{toasts:se,addToast:C,removeToast:le}=Us();i.useEffect(()=>{const r=be.onAuthStateChanged(t=>{t&&(t.isAnonymous||!t.email)?(be.signOut(),c(null),localStorage.removeItem("user_session"),x(null)):(c(t),t?localStorage.setItem("user_session",JSON.stringify({uid:t.uid,email:t.email})):(localStorage.removeItem("user_session"),x(null))),W(!1)});return()=>r()},[]),i.useEffect(()=>{if(!s)return;const r=q.ref("students"),t=q.ref("deleted_students"),a=q.ref("settings"),v=q.ref("userAdmin/"+s.uid),g=(u,P)=>{const Y=u.val();if(Y){const K=Object.keys(Y).map(re=>{const I=Y[re]||{},Z=I.កាលវិភាគ||{};return{id:re,imageUrl:F(I.រូបថត||I.imageUrl),name:F(I.ឈ្មោះ||I.name),latinName:F(I.ឈ្មោះឡាតាំង),gender:F(I.ភេទ),dob:F(I.ថ្ងៃខែឆ្នាំកំណើត),pob:F(I.ទីកន្លែងកំណើត),studentId:F(I.អត្តលេខ),academicYear:F(I.ឆ្នាំសិក្សា),generation:F(I.ជំនាន់),group:F(I.ក្រុម),class:F(I.ថ្នាក់),skill:F(I.ជំនាញ),section:F(I.ផ្នែកការងារ),position:F(I.តួនាទី),telegram:F(I.តេឡេក្រាម),mon:F(Z.ចន្ទ||I.ចន្ទ),tue:F(Z.អង្គារ៍||I.អង្គារ៍),wed:F(Z.ពុធ||I.ពុធ),thu:F(Z.ព្រហស្បត្តិ៍||I.ព្រហស្បត្តិ៍),fri:F(Z.សុក្រ||I.សុក្រ),sat:F(Z.សៅរ៍||I.សៅរ៍),sun:F(Z.អាទិត្យ||I.អាទិត្យ),originalData:I}});P(K.reverse())}else P([])};return r.on("value",u=>{g(u,b),W(!1)}),t.on("value",u=>g(u,z)),a.on("value",u=>_(u.val()||{})),v.on("value",u=>{const P=u.val();P&&x(P)}),()=>{r.off(),t.off(),a.off(),v.off()}},[s]);const T=async(r,t)=>{d(!0),S("");try{await be.signInWithEmailAndPassword(r,t)}catch(a){console.error("Login failed:",a);let v="Failed to sign in. Please check your credentials.";a.code==="auth/wrong-password"&&(v="Incorrect password."),a.code==="auth/user-not-found"&&(v="No user found with this email."),S(v)}finally{d(!1)}},G=()=>{j({isOpen:!0,type:"danger",title:"Sign Out",message:"Are you sure you want to sign out?",onConfirm:async()=>{await be.signOut(),localStorage.removeItem("user_session"),j(r=>({...r,isOpen:!1})),C("Signed out successfully","success")}})},E=i.useCallback(r=>{const t=D.find(a=>a.id===r);j({isOpen:!0,type:"danger",title:"បញ្ជាក់ការលុប",message:`តើអ្នកពិតជាចង់លុប "${t?.name}" ទៅកាន់ធុងសំរាមមែនទេ?`,onConfirm:async()=>{try{await q.ref(`deleted_students/${t.id}`).set({...t.originalData,deletedAt:Date.now()}),await q.ref(`students/${t.id}`).remove(),j(a=>({...a,isOpen:!1})),C("បានបញ្ជូនទៅធុងសំរាម","success")}catch{C("បរាជ័យក្នុងការលុប","error")}}})},[D,C]),B=i.useCallback(r=>{!r||r.length===0||j({isOpen:!0,type:"danger",title:"បញ្ជាក់ការលុបជាក្រុម",message:`តើអ្នកប្រាកដជាចង់លុបបុគ្គលិកចំនួន ${r.length} នាក់ ទៅកាន់ធុងសំរាមមែនទេ?`,onConfirm:async()=>{try{const t={};r.forEach(a=>{const v=D.find(g=>g.id===a);v&&(t[`deleted_students/${a}`]={...v.originalData,deletedAt:Date.now()},t[`students/${a}`]=null)}),await q.ref().update(t),j(a=>({...a,isOpen:!1})),C(`បានលុបចំនួន ${r.length} នាក់ជោគជ័យ`,"success")}catch{C("បរាជ័យក្នុងការលុបជាក្រុម","error")}}})},[D,C]),R=i.useCallback(r=>{j({isOpen:!0,type:"restore",title:"បញ្ជាក់ការស្តារ",message:`តើអ្នកចង់ស្តារ "${r.name}" ត្រឡប់មកវិញទេ?`,onConfirm:async()=>{try{await q.ref(`students/${r.id}`).set(r.originalData),await q.ref(`deleted_students/${r.id}`).remove(),j(t=>({...t,isOpen:!1})),C("បានស្តារទិន្នន័យជោគជ័យ","success")}catch{C("បរាជ័យ","error")}}})},[C]),J=i.useCallback(r=>{j({isOpen:!0,type:"danger",title:"លុបជារៀងរហូត",message:"តើអ្នកចង់លុបជារៀងរហូតមែនទេ? ទិន្នន័យមិនអាចយកមកវិញបានទេ។",onConfirm:async()=>{try{await q.ref(`deleted_students/${r}`).remove(),j(t=>({...t,isOpen:!1})),C("លុបជាស្ថាពរជោគជ័យ","success")}catch{C("បរាជ័យ","error")}}})},[C]),$=i.useCallback(async(r,t,a)=>{try{await q.ref(`students/${r}`).update({[t]:a})}catch{C("បរាជ័យក្នុងការកែប្រែ","error")}},[C]),te=i.useMemo(()=>({total:D.length,male:D.filter(r=>r.gender==="ប្រុស").length,female:D.filter(r=>r.gender==="ស្រី").length}),[D]);return U?e.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"h-12 w-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-slate-400 text-sm font-medium animate-pulse",children:"Loading HR Pro..."})]})}):s?e.jsxs("div",{className:"flex h-screen overflow-hidden bg-slate-50",children:[e.jsx(vs,{sidebarOpen:m,setSidebarOpen:M,adminProfile:l,user:s,handleLogout:G}),m&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-40 md:hidden backdrop-blur-sm transition-opacity",onClick:()=>M(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col h-full overflow-hidden relative",children:[e.jsx(Ns,{setSidebarOpen:M,adminProfile:l,user:s}),e.jsx("main",{className:"flex-1 overflow-y-auto px-4 pb-4 md:px-8 md:pb-8 custom-scrollbar",children:e.jsxs(es,{children:[e.jsx(ue,{path:"/",element:e.jsx(Vs,{stats:te,onNavigate:r=>V(r)})}),e.jsx(ue,{path:"/employees",element:e.jsx(Pe,{employees:D,loading:U,settings:p,isModalOpen:A,onEdit:r=>{f(r),w(!0)},onDelete:E,onInlineUpdate:$,onCreate:()=>{f(null),w(!0)},onBulkDelete:B})}),e.jsx(ue,{path:"/recycle-bin",element:e.jsx(Pe,{employees:L,loading:U,isRecycleBin:!0,onRestore:R,onPermanentDelete:J})}),e.jsx(ue,{path:"/bulk-edit",element:e.jsx(tt,{db:q,employees:D,settings:p,addToast:C,setConfirmDialog:j})}),e.jsx(ue,{path:"/settings",element:e.jsx(Bs,{db:q,settings:p,setConfirmDialog:j,addToast:C})})]})})]}),A&&e.jsx(_s,{isOpen:A,onClose:()=>w(!1),employee:O,db:q,addToast:C,settings:p}),e.jsx(Ds,{isOpen:y.isOpen,onClose:()=>j(r=>({...r,isOpen:!1})),...y}),e.jsx(As,{toasts:se,removeToast:le})]}):e.jsx(ys,{onLogin:T,loading:h,error:o})}ss.createRoot(document.getElementById("root")).render(e.jsx(ts.StrictMode,{children:e.jsx(ls,{children:e.jsx(lt,{})})}));
