import{f as H,j as e,r as o,u as ie,a as oe,N as V,R as de,b as T,c as ce,d as xe,H as he}from"./vendor-CD1ShPW7.js";(function(){const d=document.createElement("link").relList;if(d&&d.supports&&d.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))l(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const t of n.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&l(t)}).observe(document,{childList:!0,subtree:!0});function c(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function l(i){if(i.ep)return;i.ep=!0;const n=c(i);fetch(i.href,n)}})();const me={apiKey:"AIzaSyAc2g-t9A7du3K_nI2fJnw_OGxhmLfpP6s",authDomain:"dilistname.firebaseapp.com",databaseURL:"https://dilistname-default-rtdb.firebaseio.com",projectId:"dilistname",storageBucket:"dilistname.firebasestorage.app",messagingSenderId:"897983357871",appId:"1:897983357871:web:42a046bc9fb3e0543dc55a",measurementId:"G-NQ798D9J6K"};H.apps.length||H.initializeApp(me);const R=H.database(),J=H.auth(),g=({children:s,className:d,...c})=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:d,...c,children:s}),ue=s=>e.jsxs(g,{...s,children:[e.jsx("ellipse",{cx:"12",cy:"5",rx:"9",ry:"3"}),e.jsx("path",{d:"M3 5V19A9 3 0 0 0 21 19V5"}),e.jsx("path",{d:"M3 12A9 3 0 0 0 21 12"})]}),X=s=>e.jsxs(g,{...s,children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"m21 21-4.3-4.3"})]}),pe=s=>e.jsxs(g,{...s,children:[e.jsx("path",{d:"M5 12h14"}),e.jsx("path",{d:"M12 5v14"})]}),ee=s=>e.jsxs(g,{...s,children:[e.jsx("rect",{width:"7",height:"7",x:"3",y:"3",rx:"1"}),e.jsx("rect",{width:"7",height:"7",x:"14",y:"3",rx:"1"}),e.jsx("rect",{width:"7",height:"7",x:"14",y:"14",rx:"1"}),e.jsx("rect",{width:"7",height:"7",x:"3",y:"14",rx:"1"})]}),ge=s=>e.jsxs(g,{...s,children:[e.jsx("line",{x1:"8",x2:"21",y1:"6",y2:"6"}),e.jsx("line",{x1:"8",x2:"21",y1:"12",y2:"12"}),e.jsx("line",{x1:"8",x2:"21",y1:"18",y2:"18"}),e.jsx("line",{x1:"3",x2:"3.01",y1:"6",y2:"6"}),e.jsx("line",{x1:"3",x2:"3.01",y1:"12",y2:"12"}),e.jsx("line",{x1:"3",x2:"3.01",y1:"18",y2:"18"})]}),se=s=>e.jsx(g,{...s,children:e.jsx("path",{d:"M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"})}),Y=s=>e.jsxs(g,{...s,children:[e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),e.jsx("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}),e.jsx("line",{x1:"10",x2:"10",y1:"11",y2:"17"}),e.jsx("line",{x1:"14",x2:"14",y1:"11",y2:"17"})]}),W=s=>e.jsxs(g,{...s,children:[e.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),fe=s=>e.jsxs(g,{...s,children:[e.jsx("rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2"}),e.jsx("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})]}),be=s=>e.jsxs(g,{...s,children:[e.jsx("rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",x2:"16",y1:"2",y2:"6"}),e.jsx("line",{x1:"8",x2:"8",y1:"2",y2:"6"}),e.jsx("line",{x1:"3",x2:"21",y1:"10",y2:"10"})]}),te=s=>e.jsxs(g,{...s,children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("path",{d:"M22 21v-2a4 4 0 0 0-3-3.87"}),e.jsx("path",{d:"M16 3.13a4 4 0 0 1 0 7.75"})]}),je=s=>e.jsxs(g,{...s,children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("polyline",{points:"16 11 18 13 22 9"})]}),we=s=>e.jsxs(g,{...s,children:[e.jsx("path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"9",cy:"7",r:"4"}),e.jsx("line",{x1:"19",x2:"19",y1:"8",y2:"14"}),e.jsx("line",{x1:"22",x2:"16",y1:"11",y2:"11"})]}),ve=s=>e.jsxs(g,{...s,children:[e.jsx("line",{x1:"22",x2:"11",y1:"2",y2:"13"}),e.jsx("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})]}),Ne=s=>e.jsxs(g,{...s,children:[e.jsx("path",{d:"M18 6 6 18"}),e.jsx("path",{d:"m6 6 12 12"})]}),ae=s=>e.jsxs(g,{...s,children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),ye=s=>e.jsxs(g,{...s,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",x2:"12",y1:"8",y2:"12"}),e.jsx("line",{x1:"12",x2:"12.01",y1:"16",y2:"16"})]}),ke=s=>e.jsx(g,{...s,children:e.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),Ce=s=>e.jsx(g,{...s,children:e.jsx("polyline",{points:"15 18 9 12 15 6"})}),Se=s=>e.jsx(g,{...s,children:e.jsx("polyline",{points:"9 18 15 12 9 6"})}),Ie=s=>e.jsx(g,{...s,children:e.jsx("polyline",{points:"6 9 12 15 18 9"})}),le=s=>e.jsxs(g,{...s,children:[e.jsx("polyline",{points:"1 4 1 10 7 10"}),e.jsx("path",{d:"M3.51 15a9 9 0 1 0 2.13-9.36L1 10"})]}),Me=s=>e.jsxs(g,{...s,children:[e.jsx("path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"}),e.jsx("line",{x1:"12",x2:"12",y1:"9",y2:"13"}),e.jsx("line",{x1:"12",x2:"12.01",y1:"17",y2:"17"})]}),Le=s=>e.jsxs(g,{...s,children:[e.jsx("line",{x1:"4",x2:"20",y1:"12",y2:"12"}),e.jsx("line",{x1:"4",x2:"20",y1:"6",y2:"6"}),e.jsx("line",{x1:"4",x2:"20",y1:"18",y2:"18"})]}),$e=s=>e.jsxs(g,{...s,children:[e.jsx("path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),e.jsx("polyline",{points:"9 22 9 12 15 12 15 22"})]}),re=s=>e.jsxs(g,{...s,children:[e.jsx("path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.35a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]}),De=s=>e.jsxs(g,{...s,children:[e.jsx("path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"}),e.jsx("polyline",{points:"16 17 21 12 16 7"}),e.jsx("line",{x1:"21",x2:"9",y1:"12",y2:"12"})]}),Ee=s=>e.jsxs(g,{...s,children:[e.jsx("path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"}),e.jsx("path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0"})]}),Oe=s=>e.jsxs(g,{...s,children:[e.jsx("polyline",{points:"9 11 12 14 22 4"}),e.jsx("path",{d:"M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"})]}),Ae=s=>e.jsx(g,{...s,children:e.jsx("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"})}),Pe=({toasts:s,removeToast:d})=>e.jsx("div",{className:"fixed bottom-6 right-6 z-[100] flex flex-col gap-3 pointer-events-none",children:s.map(c=>e.jsxs("div",{className:`pointer-events-auto flex items-center gap-3 px-5 py-3.5 rounded-2xl shadow-xl shadow-slate-200/50 transform transition-all animate-fade-in border ${c.type==="success"?"bg-white text-emerald-600 border-emerald-100":"bg-white text-red-600 border-red-100"}`,children:[c.type==="success"?e.jsx("div",{className:"bg-emerald-100 p-1.5 rounded-full",children:e.jsx(ae,{className:"h-4 w-4"})}):e.jsx("div",{className:"bg-red-100 p-1.5 rounded-full",children:e.jsx(ye,{className:"h-4 w-4"})}),e.jsx("span",{className:"font-medium text-sm text-slate-700",children:c.message}),e.jsx("button",{onClick:()=>d(c.id),className:"opacity-60 hover:opacity-100 hover:bg-slate-100 p-1 rounded-md transition-all",children:e.jsx(Ne,{className:"h-4 w-4"})})]},c.id))}),O=o.memo(({value:s,onSave:d,className:c,options:l})=>{const[i,n]=o.useState(!1),[t,v]=o.useState(s),k=o.useRef(null);o.useEffect(()=>{v(s)},[s]),o.useEffect(()=>{i&&k.current&&k.current.focus()},[i]);const C=()=>{n(!1),t!==s&&d(t)},D=x=>{const N=x.target.value;v(N),d(N),n(!1)};return i?l&&l.length>0?e.jsxs("select",{ref:k,value:t,onChange:D,onBlur:()=>n(!1),className:`w-full min-w-[100px] p-1.5 border-2 border-indigo-400 rounded-lg bg-white text-slate-900 outline-none text-sm shadow-lg animate-in fade-in zoom-in duration-200 ${c}`,children:[e.jsx("option",{value:"",disabled:!0,children:"Select..."}),!l.includes(s)&&s&&e.jsx("option",{value:s,children:s}),l.map((x,N)=>e.jsx("option",{value:x,children:x},`${x}-${N}`))]}):e.jsx("input",{ref:k,value:t,onChange:x=>v(x.target.value),onBlur:C,onKeyDown:x=>{x.key==="Enter"?k.current.blur():x.key==="Escape"&&(v(s),n(!1))},className:`w-full min-w-[80px] p-1.5 border-2 border-indigo-400 rounded-lg bg-white text-slate-900 outline-none text-sm shadow-lg animate-in fade-in zoom-in duration-200 ${c}`}):e.jsxs("div",{onClick:x=>{x.stopPropagation(),n(!0)},className:`cursor-pointer group hover:bg-indigo-50 hover:text-indigo-700 px-2 py-1.5 -mx-2 rounded-lg transition-all border border-transparent hover:border-indigo-100 min-h-[32px] flex items-center relative ${c}`,title:"Click to edit",children:[e.jsx("span",{className:"truncate w-full",children:s||e.jsx("span",{className:"text-slate-300 italic text-xs",children:"Empty"})}),e.jsx("span",{className:"absolute right-1 opacity-0 group-hover:opacity-40 text-[10px] text-indigo-400",children:"▼"})]})}),q=o.memo(({icon:s,label:d,value:c,color:l})=>e.jsxs("div",{className:"bg-white/80 backdrop-blur-xl p-6 rounded-3xl border border-white/50 shadow-[0_8px_30px_rgb(0,0,0,0.04)] flex items-center gap-5 hover:-translate-y-1 transition-transform duration-300 group",children:[e.jsx("div",{className:`p-4 rounded-2xl ${l.replace("bg-","bg-opacity-10 text-")} group-hover:scale-110 transition-transform duration-300`,children:e.jsx(s,{className:`h-8 w-8 ${l.replace("bg-","text-")}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-slate-500 text-sm font-semibold tracking-wide uppercase mb-1",children:d}),e.jsx("h3",{className:"text-3xl font-extrabold text-slate-800 tracking-tight",children:c})]})]})),Re=({isOpen:s,onClose:d,onConfirm:c,title:l,message:i,type:n="danger"})=>s?e.jsx("div",{className:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-[60] flex items-center justify-center p-4 animate-fade-in",children:e.jsx("div",{className:"bg-white rounded-3xl max-w-sm w-full p-8 animate-scale-in shadow-2xl relative",children:e.jsxs("div",{className:"flex flex-col items-center text-center",children:[e.jsx("div",{className:`p-4 rounded-full mb-5 ${n==="danger"?"bg-red-50 text-red-500":"bg-blue-50 text-blue-500"}`,children:n==="danger"?e.jsx(Me,{className:"h-8 w-8"}):e.jsx(le,{className:"h-8 w-8"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-800 mb-2",children:l}),e.jsx("p",{className:"text-slate-500 text-sm mb-8 leading-relaxed",children:i}),e.jsxs("div",{className:"flex gap-3 w-full",children:[e.jsx("button",{onClick:d,className:"flex-1 py-3 rounded-xl border border-slate-200 text-slate-600 font-bold hover:bg-slate-50 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:c,className:`flex-1 py-3 rounded-xl text-white font-bold shadow-lg hover:shadow-xl transition-all hover:-translate-y-0.5 ${n==="danger"?"bg-red-500 hover:bg-red-600 shadow-red-500/30":"bg-blue-600 hover:bg-blue-700 shadow-blue-500/30"}`,children:n==="danger"?"Confirm":"Restore"})]})]})})}):null;function _e({stats:s,onNavigate:d}){return e.jsxs("div",{className:"space-y-8 animate-fade-in max-w-7xl mx-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsx(q,{icon:te,label:"Total Employees",value:s.total,color:"bg-blue-500"}),e.jsx(q,{icon:je,label:"Male Staff",value:s.male,color:"bg-indigo-500"}),e.jsx(q,{icon:we,label:"Female Staff",value:s.female,color:"bg-pink-500"})]}),e.jsxs("div",{className:"glass-panel rounded-3xl p-10 flex flex-col items-center justify-center text-center min-h-[400px]",children:[e.jsx("div",{className:"bg-indigo-50 p-6 rounded-full mb-6 animate-scale-in",children:e.jsx($e,{className:"h-16 w-16 text-indigo-500"})}),e.jsx("h2",{className:"text-3xl font-extrabold text-slate-800 mb-3",children:"Welcome to HR System Pro"}),e.jsx("p",{className:"text-slate-500 max-w-lg text-lg mb-8",children:"គ្រប់គ្រងទិន្នន័យបុគ្គលិករបស់អ្នកដោយងាយស្រួល និងមានប្រសិទ្ធភាពខ្ពស់។"}),e.jsx("button",{onClick:()=>d("employees"),className:"px-8 py-3 bg-indigo-600 text-white rounded-2xl font-bold hover:bg-indigo-700 shadow-xl shadow-indigo-300 hover:-translate-y-1 transition-all",children:"ចាប់ផ្តើមគ្រប់គ្រង"})]})]})}function ze({db:s,settings:d,setConfirmDialog:c,addToast:l}){const[i,n]=o.useState("skills"),[t,v]=o.useState(""),k=[{id:"skills",label:"ជំនាញ (Skills)"},{id:"groups",label:"ក្រុម (Groups)"},{id:"classes",label:"ថ្នាក់ (Classes)"},{id:"sections",label:"ផ្នែក (Sections)"},{id:"positions",label:"តួនាទី (Positions)"},{id:"schedules",label:"កាលវិភាគ (Schedules)"}],C=async()=>{if(t.trim())try{const x=d?.[i]||[];if(x.includes(t)){l("មានរួចហើយ!","error");return}await s.ref(`settings/${i}`).set([...x,t]),v(""),l("បានបន្ថែមជោគជ័យ")}catch(x){console.error(x),l("បរាជ័យ","error")}},D=x=>{c({isOpen:!0,type:"danger",title:"លុបការកំណត់",message:`តើអ្នកពិតជាចង់លុប "${x}" ចេញពីបញ្ជីមែនទេ?`,onConfirm:async()=>{try{const N=d?.[i]||[];await s.ref(`settings/${i}`).set(N.filter($=>$!==x)),c($=>({...$,isOpen:!1})),l("បានលុបជោគជ័យ")}catch(N){console.error(N),l("បរាជ័យ","error")}}})};return e.jsxs("div",{className:"animate-fade-in space-y-6",children:[e.jsxs("h2",{className:"text-2xl md:text-3xl font-extrabold text-slate-800 flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-xl text-blue-600",children:e.jsx(re,{className:"h-6 w-6"})})," ការកំណត់ Dropdown"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 md:gap-8",children:[e.jsx("div",{className:"glass-panel rounded-3xl p-4 h-fit",children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-1 gap-2 md:space-y-2",children:k.map(x=>e.jsxs("button",{onClick:()=>n(x.id),className:`w-full text-left px-3 py-3 md:px-5 md:py-3.5 rounded-xl md:rounded-2xl font-bold transition-all duration-300 flex justify-between items-center text-sm md:text-base ${i===x.id?"bg-indigo-600 text-white shadow-lg shadow-indigo-300 transform scale-105":"text-slate-500 hover:bg-white hover:text-slate-800"}`,children:[e.jsx("span",{className:"truncate",children:x.label})," ",i===x.id&&e.jsx("div",{className:"hidden md:block h-2 w-2 bg-white rounded-full animate-pulse shrink-0"})]},x.id))})}),e.jsxs("div",{className:"md:col-span-3 glass-panel rounded-3xl p-5 md:p-8 min-h-[500px]",children:[e.jsxs("h3",{className:"text-xl font-bold text-slate-700 mb-6 border-b border-slate-200/50 pb-4",children:[k.find(x=>x.id===i)?.label," List"]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mb-8",children:[e.jsx("input",{value:t,onChange:x=>v(x.target.value),onKeyDown:x=>x.key==="Enter"&&C(),placeholder:"បញ្ចូលឈ្មោះថ្មី...",className:"flex-1 px-5 py-3 border border-slate-200 rounded-2xl focus:ring-4 focus:ring-indigo-100 outline-none shadow-sm input-modern w-full"}),e.jsx("button",{onClick:C,className:"px-8 py-3 bg-indigo-600 text-white rounded-2xl hover:bg-indigo-700 font-bold shadow-lg shadow-indigo-200 transition-all hover:-translate-y-1 w-full sm:w-auto",children:"បន្ថែម"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:d?.[i]?.map((x,N)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-white border border-slate-100 rounded-2xl group hover:border-indigo-200 hover:shadow-md transition-all",children:[e.jsx("span",{className:"font-semibold text-slate-700 break-words",children:x}),e.jsx("button",{onClick:()=>D(x),className:"p-2 text-slate-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors shrink-0 cursor-pointer",children:e.jsx(Y,{className:"h-4 w-4"})})]},N))})]})]})]})}const ne=["ឆ្នាំទី១","ឆ្នាំទី២","ឆ្នាំទី៣","ឆ្នាំទី៤"],Fe=Array.from({length:14},(s,d)=>`ទី${d+1}`),Ue=["ប្រុស","ស្រី"],I=s=>s==null||typeof s=="object"?"":String(s);function Ye({db:s,employees:d,settings:c,addToast:l,setConfirmDialog:i}){const[n,t]=o.useState(new Set),[v,k]=o.useState(""),[C,D]=o.useState(""),[x,N]=o.useState(""),[$,S]=o.useState(!1),[y,A]=o.useState({group:"",section:"",position:"",academicYear:"",mon:"",tue:"",wed:"",thu:"",fri:"",sat:"",sun:""}),j=o.useMemo(()=>{const r=d.map(a=>a.class).filter(a=>a&&a.trim()!=="");return[...new Set(r)].sort()},[d]),_=o.useMemo(()=>{const r=d.map(a=>a.academicYear).filter(a=>a&&a.trim()!=="");return[...new Set(r)].sort()},[d]),f=o.useMemo(()=>d.filter(r=>{const a=v?r.class===v:!0,u=C?r.academicYear===C:!0,m=/^\d+$/.test(r.studentId||""),h=x.toLowerCase().replace(/\s+/g,""),L=(r.name||"").toLowerCase().replace(/\s+/g,""),U=(r.latinName||"").toLowerCase().replace(/\s+/g,""),B=(r.studentId||"").toLowerCase().replace(/\s+/g,""),K=L.includes(h)||U.includes(h)||B.includes(h);return a&&u&&m&&K}),[d,v,C,x]),M=r=>{if(r.target.checked){const a=new Set(f.map(u=>u.id));t(a)}else t(new Set)},p=r=>{const a=new Set(n);a.has(r)?a.delete(r):a.add(r),t(a)},b=(r,a)=>A(u=>({...u,[r]:a})),E=async()=>{S(!0),i(h=>({...h,isOpen:!1}));const r={},a={};y.group&&(a.ក្រុម=y.group),y.section&&(a.ផ្នែកការងារ=y.section),y.position&&(a.តួនាទី=y.position),y.academicYear&&(a.ឆ្នាំសិក្សា=y.academicYear);const u=["mon","tue","wed","thu","fri","sat","sun"],m=["ចន្ទ","អង្គារ៍","ពុធ","ព្រហស្បត្តិ៍","សុក្រ","សៅរ៍","អាទិត្យ"];n.forEach(h=>{Object.keys(a).forEach(L=>{r[`students/${h}/${L}`]=a[L]}),u.forEach((L,U)=>{y[L]&&(r[`students/${h}/កាលវិភាគ/${m[U]}`]=y[L])})});try{Object.keys(r).length>0?(await s.ref().update(r),l(`បានកែប្រែទិន្នន័យជោគជ័យសម្រាប់ ${n.size} នាក់`,"success"),t(new Set),A({group:"",section:"",position:"",academicYear:"",mon:"",tue:"",wed:"",thu:"",fri:"",sat:"",sun:""})):l("សូមជ្រើសរើសទិន្នន័យដែលត្រូវកែប្រែ","warning")}catch(h){console.error(h),l("បរាជ័យក្នុងការកែប្រែ","error")}finally{S(!1)}},z=()=>{if(n.size===0){l("សូមជ្រើសរើសបុគ្គលិកជាមុនសិន","warning");return}if(!Object.values(y).some(a=>a!=="")){l("សូមជ្រើសរើសព័ត៌មានដែលត្រូវកែប្រែ","warning");return}i({isOpen:!0,type:"warning",title:"បញ្ជាក់ការកែប្រែ",message:`តើអ្នកចង់កែប្រែទិន្នន័យសម្រាប់បុគ្គលិកចំនួន ${n.size} នាក់ដែលបានជ្រើសរើសមែនទេ?`,onConfirm:E})},P=(r,a,u,m="មិនកែប្រែ")=>e.jsxs("div",{className:"min-w-[140px]",children:[e.jsx("label",{className:"text-[10px] font-bold text-slate-500 uppercase mb-1 block",children:r}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:y[a],onChange:h=>b(a,h.target.value),className:`w-full py-2 pl-2 pr-6 border rounded-xl outline-none text-xs font-bold appearance-none transition-all ${y[a]?"bg-indigo-50 border-indigo-300 text-indigo-700":"bg-white border-slate-200 text-slate-400"}`,children:[e.jsx("option",{value:"",children:m}),u&&u.map(h=>e.jsx("option",{value:h,children:h},h))]}),e.jsx("div",{className:"absolute inset-y-0 right-2 flex items-center pointer-events-none opacity-50",children:e.jsx(Ie,{className:"h-3 w-3"})})]})]});return e.jsxs("div",{className:"h-full flex flex-col relative animate-fade-in",children:[e.jsxs("div",{className:"glass-panel p-4 rounded-3xl flex flex-col xl:flex-row justify-between items-start xl:items-center gap-4 mb-4 shrink-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 w-full xl:w-auto",children:[e.jsxs("div",{className:"relative w-full md:w-64 group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(X,{className:"h-4 w-4 text-slate-400 group-focus-within:text-indigo-500 transition-colors"})}),e.jsx("input",{type:"text",className:"block w-full pl-10 pr-3 py-2.5 border border-slate-200 rounded-xl bg-white text-sm font-medium outline-none focus:ring-2 focus:ring-indigo-200 transition-all placeholder:text-slate-400",placeholder:"ស្វែងរក...",value:x,onChange:r=>N(r.target.value)})]}),e.jsxs("div",{className:"flex gap-3 w-full md:w-auto overflow-x-auto pb-1 md:pb-0",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 bg-indigo-50/50 rounded-xl border border-indigo-100",children:[e.jsx(Ae,{className:"h-4 w-4 text-indigo-500"}),e.jsx("span",{className:"text-xs font-bold text-indigo-600",children:"Filter:"})]}),e.jsxs("select",{value:v,onChange:r=>k(r.target.value),className:"py-2.5 px-4 rounded-xl border border-slate-200 bg-white text-sm font-medium outline-none focus:ring-2 focus:ring-indigo-200 min-w-[120px]",children:[e.jsx("option",{value:"",children:"គ្រប់ថ្នាក់"}),j.map(r=>e.jsx("option",{value:r,children:r},r))]}),e.jsxs("select",{value:C,onChange:r=>D(r.target.value),className:"py-2.5 px-4 rounded-xl border border-slate-200 bg-white text-sm font-medium outline-none focus:ring-2 focus:ring-indigo-200 min-w-[120px]",children:[e.jsx("option",{value:"",children:"គ្រប់ឆ្នាំសិក្សា"}),_.map(r=>e.jsx("option",{value:r,children:r},r))]})]})]}),e.jsxs("div",{className:"text-xs font-bold text-slate-500 bg-white px-3 py-1.5 rounded-lg border border-slate-200",children:["Total Found: ",e.jsx("span",{className:"text-indigo-600 text-sm",children:f.length})]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar pb-32",children:e.jsx("div",{className:"glass-panel rounded-3xl overflow-hidden bg-white/80",children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100",children:[e.jsx("thead",{className:"bg-slate-50/90 backdrop-blur sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left w-12",children:e.jsx("input",{type:"checkbox",onChange:M,checked:f.length>0&&n.size===f.length,className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 h-4 w-4 cursor-pointer"})}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-extrabold text-slate-500 uppercase",children:"Profile"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-extrabold text-slate-500 uppercase",children:"ID / Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-extrabold text-slate-500 uppercase",children:"Current Info"})]})}),e.jsxs("tbody",{className:"divide-y divide-slate-100",children:[f.map(r=>e.jsxs("tr",{className:`hover:bg-indigo-50/30 transition-colors ${n.has(r.id)?"bg-indigo-50/60":""}`,onClick:()=>p(r.id),children:[e.jsx("td",{className:"px-4 py-3",onClick:a=>a.stopPropagation(),children:e.jsx("input",{type:"checkbox",checked:n.has(r.id),onChange:()=>p(r.id),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 h-4 w-4 cursor-pointer"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"h-10 w-10 rounded-full overflow-hidden border border-slate-200",children:r.imageUrl?e.jsx("img",{src:r.imageUrl,className:"h-full w-full object-cover"}):e.jsx("div",{className:"h-full w-full bg-slate-100 flex items-center justify-center text-slate-400",children:e.jsx(W,{className:"h-5 w-5"})})})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-mono text-xs font-bold text-indigo-600 bg-indigo-50 px-1.5 py-0.5 rounded w-fit mb-1",children:r.studentId}),e.jsx("span",{className:"text-sm font-bold text-slate-700",children:r.name}),e.jsx("span",{className:"text-xs text-slate-400",children:r.latinName})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs",children:[e.jsx("span",{className:"bg-white border border-slate-200 px-2 py-1 rounded text-slate-600",children:r.class||"No Class"}),e.jsx("span",{className:"bg-white border border-slate-200 px-2 py-1 rounded text-slate-600",children:r.academicYear||"No Year"})]})})]},r.id)),f.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center py-10 text-slate-400 italic",children:"No employees found"})})]})]})})}),e.jsxs("div",{className:`absolute bottom-0 left-0 right-0 glass-modal rounded-t-3xl border-t border-indigo-100 shadow-[0_-10px_40px_rgba(0,0,0,0.1)] transition-transform duration-300 transform ${n.size>0?"translate-y-0":"translate-y-full"}`,children:[e.jsxs("div",{className:"p-2 bg-gradient-to-r from-indigo-600 to-blue-600 text-white text-center text-xs font-bold tracking-wider rounded-t-3xl",children:["កែប្រែទិន្នន័យសម្រាប់ ",n.size," នាក់"]}),e.jsx("div",{className:"p-4 md:p-6 overflow-x-auto",children:e.jsxs("div",{className:"flex gap-6 min-w-max",children:[e.jsxs("div",{className:"flex gap-3 pr-6 border-r border-slate-200",children:[e.jsxs("div",{className:"flex items-center gap-2 text-indigo-600 font-bold text-xs whitespace-nowrap",children:[e.jsx(fe,{className:"h-4 w-4"})," ការងារ:"]}),P("ក្រុម","group",c?.groups),P("ផ្នែក","section",c?.sections),P("តួនាទី","position",c?.positions),P("ឆ្នាំសិក្សា","academicYear",ne)]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 text-orange-500 font-bold text-xs whitespace-nowrap",children:[e.jsx(be,{className:"h-4 w-4"})," កាលវិភាគ:"]}),["mon","tue","wed","thu","fri","sat","sun"].map((r,a)=>e.jsxs("div",{className:"min-w-[80px]",children:[e.jsx("label",{className:"text-[9px] font-bold text-slate-400 uppercase mb-1 block text-center",children:["ចន្ទ","អង្គារ៍","ពុធ","ព្រហ","សុក្រ","សៅរ៍","អាទិត្យ"][a]}),e.jsxs("select",{value:y[r],onChange:u=>b(r,u.target.value),className:`w-full py-1.5 px-1 border rounded-lg text-xs font-bold outline-none text-center ${y[r]?"bg-orange-50 border-orange-200 text-orange-700":"bg-white border-slate-200"}`,children:[e.jsx("option",{value:"",children:"-"}),c?.schedules?.map(u=>e.jsx("option",{value:u,children:u},u))]})]},r))]})]})}),e.jsx("div",{className:"p-4 border-t border-slate-100 bg-white/50 flex justify-end",children:e.jsxs("button",{onClick:z,disabled:$,className:"px-8 py-2.5 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl font-bold shadow-lg shadow-indigo-200 flex items-center gap-2 disabled:opacity-50 transition-all active:scale-95",children:[$?e.jsx(ke,{className:"h-4 w-4 animate-spin"}):e.jsx(ae,{className:"h-4 w-4"})," រក្សាទុកការកែប្រែ"]})})]})]})}const Be=["2023-2024","2024-2025","2025-2026","2026-2027"],Ve=["Gen 1","Gen 2","Gen 3","Gen 4","Gen 5","Gen 6"],Te=s=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[e.jsx("path",{d:"M18 6 6 18"}),e.jsx("path",{d:"m6 6 12 12"})]}),Ge=s=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[e.jsx("path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"}),e.jsx("circle",{cx:"12",cy:"13",r:"3"})]}),He=s=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[e.jsx("path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"}),e.jsx("polyline",{points:"17 8 12 3 7 8"}),e.jsx("line",{x1:"12",x2:"12",y1:"3",y2:"15"})]}),We=s=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[e.jsx("path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"}),e.jsx("circle",{cx:"12",cy:"7",r:"4"})]}),Ke=s=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[e.jsx("rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2"}),e.jsx("path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"})]}),qe=s=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[e.jsx("rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2"}),e.jsx("line",{x1:"16",x2:"16",y1:"2",y2:"6"}),e.jsx("line",{x1:"8",x2:"8",y1:"2",y2:"6"}),e.jsx("line",{x1:"3",x2:"21",y1:"10",y2:"10"})]}),Xe=s=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:e.jsx("path",{d:"m6 9 6 6 6-6"})}),Ze=s=>e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:e.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})}),Je=s=>e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...s,children:[e.jsx("path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14"}),e.jsx("polyline",{points:"22 4 12 14.01 9 11.01"})]}),Qe="dsruankj0",es="staff_app";function ss({isOpen:s,onClose:d,employee:c,db:l,addToast:i,settings:n}){const[t,v]=o.useState({name:"",latinName:"",gender:"ប្រុស",dob:"",pob:"",studentId:"",academicYear:"",generation:"",group:"",class:"",skill:"",section:"",position:"",telegram:"",imageUrl:"",mon:"",tue:"",wed:"",thu:"",fri:"",sat:"",sun:""}),[k,C]=o.useState(!1),[D,x]=o.useState(""),[N,$]=o.useState(null);o.useEffect(()=>{c?(v({...c}),x(c.imageUrl||""),$(null)):(x(""),$(null),v({name:"",latinName:"",gender:"ប្រុស",dob:"",pob:"",studentId:"",academicYear:"",generation:"",group:"",class:"",skill:"",section:"",position:"",telegram:"",imageUrl:"",mon:"",tue:"",wed:"",thu:"",fri:"",sat:"",sun:""}))},[c]);const S=M=>{const{name:p,value:b}=M.target;if(!(p==="name"&&/[^ \u1780-\u17FF]/.test(b))){if(p==="latinName"){if(/[^a-zA-Z\s]/.test(b))return;v(E=>({...E,[p]:b.toUpperCase()}));return}v(E=>({...E,[p]:b}))}},y=M=>{const p=M.target.files[0];if(!p)return;if(p.size>5*1024*1024){alert("រូបភាពធំពេក! សូមជ្រើសរើសរូបភាពក្រោម 5MB");return}$(p);const b=new FileReader;b.onloadend=()=>{x(b.result)},b.readAsDataURL(p)},A=async M=>{const p=new FormData;p.append("file",M),p.append("upload_preset",es);const b=await fetch(`https://api.cloudinary.com/v1_1/${Qe}/image/upload`,{method:"POST",body:p});if(!b.ok)throw new Error("Cloudinary upload failed");return(await b.json()).secure_url},j=async M=>{M.preventDefault(),C(!0);try{if(!t.studentId||t.studentId.trim()===""){alert("សូមបញ្ចូលអត្តលេខ (ID) ជាមុនសិន!"),C(!1);return}if(t.telegram&&!/^(https?:\/\/)?(t\.me\/|telegram\.me\/)?[a-zA-Z0-9_]{5,}$/.test(t.telegram)){alert("តេឡេក្រាមត្រូវតែជា Link (ឧ. t.me/username)!"),C(!1);return}let p=t.imageUrl;if(N)try{p=await A(N)}catch(E){console.error("Image upload failed:",E),alert("បរាជ័យក្នុងការ Upload រូបភាព។ សូមព្យាយាមម្តងទៀត។"),C(!1);return}const b={ឈ្មោះ:t.name,ឈ្មោះឡាតាំង:t.latinName,ភេទ:t.gender,ថ្ងៃខែឆ្នាំកំណើត:t.dob,ទីកន្លែងកំណើត:t.pob,អត្តលេខ:t.studentId,ឆ្នាំសិក្សា:t.academicYear,ជំនាន់:t.generation,ក្រុម:t.group,ថ្នាក់:t.class,ជំនាញ:t.skill,ផ្នែកការងារ:t.section,តួនាទី:t.position,តេឡេក្រាម:t.telegram,រូបថត:p,កាលវិភាគ:{ចន្ទ:t.mon,អង្គារ៍:t.tue,ពុធ:t.wed,ព្រហស្បត្តិ៍:t.thu,សុក្រ:t.fri,សៅរ៍:t.sat,អាទិត្យ:t.sun}};if(c?.id)await l.ref(`students/${c.id}`).update(b),i("កែប្រែព័ត៌មានជោគជ័យ");else{if((await l.ref(`students/${t.studentId}`).once("value")).exists()){alert(`អត្តលេខ ${t.studentId} មានរួចហើយ! សូមប្រើអត្តលេខផ្សេង។`),C(!1);return}await l.ref(`students/${t.studentId}`).set(b),i("បញ្ចូលទិន្នន័យថ្មីជោគជ័យ")}d()}catch(p){console.error(p),i("បរាជ័យក្នុងការរក្សាទុក: "+p.message,"error")}finally{C(!1)}},_=o.useMemo(()=>t.name?.trim().length>0&&t.studentId?.trim().length>0,[t.name,t.studentId]),f=(M,p,b,E=!1)=>e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block tracking-wide",children:[M," ",E&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:p,value:t[p],onChange:S,className:"w-full p-3 border border-slate-200 rounded-xl bg-slate-50/50 outline-none input-modern",children:[e.jsx("option",{value:"",children:"ជ្រើសរើស..."}),b&&b.map(z=>e.jsx("option",{value:z,children:z},z))]})]});return s?e.jsx("div",{className:"fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in",children:e.jsxs("div",{className:"glass-modal rounded-3xl w-full max-w-5xl shadow-2xl overflow-hidden flex flex-col max-h-[95vh] border border-white animate-scale-in",children:[e.jsxs("div",{className:"px-8 py-5 border-b border-slate-100 flex justify-between items-center bg-white/50 shrink-0",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-slate-800 tracking-tight",children:c?"កែប្រែព័ត៌មាន":"បញ្ចូលបុគ្គលិកថ្មី"}),e.jsx("p",{className:"text-sm text-slate-500 font-medium",children:"សូមបំពេញព័ត៌មានឱ្យបានត្រឹមត្រូវ"})]}),e.jsx("button",{onClick:d,className:"p-2 rounded-full hover:bg-slate-200 transition-colors",children:e.jsx(Te,{className:"h-6 w-6 text-slate-500"})})]}),e.jsxs("form",{onSubmit:j,className:"p-8 overflow-y-auto grow custom-scrollbar bg-slate-50/30",children:[e.jsxs("div",{className:"flex gap-10 flex-col lg:flex-row mb-8",children:[e.jsxs("div",{className:"flex flex-col items-center gap-6 lg:w-1/4",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"h-48 w-48 rounded-3xl border-4 border-white overflow-hidden bg-white shadow-xl rotate-3 group-hover:rotate-0 transition-all duration-500",children:D?e.jsx("img",{src:D,className:"h-full w-full object-cover",alt:"Preview"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center text-slate-300",children:e.jsx(Ge,{className:"h-16 w-16"})})}),e.jsxs("label",{className:"absolute -bottom-2 -right-2 bg-indigo-600 p-3.5 rounded-2xl text-white cursor-pointer shadow-lg hover:bg-indigo-700 hover:scale-110 transition-all ring-4 ring-white",children:[e.jsx(He,{className:"h-5 w-5"}),e.jsx("input",{type:"file",accept:"image/*",className:"hidden",onChange:y})]})]}),e.jsxs("div",{className:"w-full mt-4",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 block text-center",children:["លេខសម្គាល់ (ID) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{name:"studentId",value:t.studentId,onChange:S,disabled:!!c,className:`w-full p-4 border-slate-200 rounded-2xl bg-white focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 transition-all text-center font-mono font-bold text-xl text-indigo-600 tracking-widest shadow-sm input-modern ${c?"opacity-70 cursor-not-allowed":""}`,placeholder:"ID..."}),!!c&&e.jsx("p",{className:"text-[10px] text-center text-slate-400 mt-1",children:"ID មិនអាចកែបានទេ (Edit)"})]})]}),e.jsxs("div",{className:"flex-1 space-y-8",children:[e.jsxs("div",{className:"bg-white/60 p-6 rounded-3xl border border-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 pb-2 border-b border-slate-100",children:[e.jsx(We,{className:"h-5 w-5 text-indigo-500"}),e.jsx("h3",{className:"font-bold text-slate-800",children:"ព័ត៌មានផ្ទាល់ខ្លួន"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:["ឈ្មោះ (ខ្មែរ) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{name:"name",value:t.name,onChange:S,required:!0,className:"w-full p-3 border border-slate-200 rounded-xl bg-slate-50/50 outline-none input-modern"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:["ឈ្មោះ (ឡាតាំង) ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{name:"latinName",value:t.latinName,onChange:S,className:"w-full p-3 border border-slate-200 rounded-xl bg-slate-50/50 outline-none input-modern"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:"ភេទ"}),e.jsxs("select",{name:"gender",value:t.gender,onChange:S,className:"w-full p-3 border border-slate-200 rounded-xl bg-slate-50/50 outline-none input-modern",children:[e.jsx("option",{value:"ប្រុស",children:"ប្រុស"}),e.jsx("option",{value:"ស្រី",children:"ស្រី"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:"ថ្ងៃកំណើត"}),e.jsx("input",{name:"dob",value:t.dob,onChange:S,placeholder:"DD/MM/YYYY",className:"w-full p-3 border border-slate-200 rounded-xl bg-slate-50/50 outline-none input-modern"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:"ទីកន្លែងកំណើត"}),e.jsx("input",{name:"pob",value:t.pob,onChange:S,className:"w-full p-3 border border-slate-200 rounded-xl bg-slate-50/50 outline-none input-modern"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs font-bold text-slate-500 uppercase mb-1.5 block",children:"តេឡេក្រាម Link"}),e.jsx("input",{name:"telegram",value:t.telegram,onChange:S,className:"w-full p-3 border border-slate-200 rounded-xl bg-slate-50/50 outline-none input-modern text-blue-600"})]})]})]}),e.jsxs("div",{className:"bg-white/60 p-6 rounded-3xl border border-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 pb-2 border-b border-slate-100",children:[e.jsx(Ke,{className:"h-5 w-5 text-purple-500"}),e.jsx("h3",{className:"font-bold text-slate-800",children:"ការសិក្សា & ការងារ"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5",children:[f("ជំនាញ","skill",n?.skills),f("ឆ្នាំសិក្សា","academicYear",Be),f("ជំនាន់","generation",Ve),f("ក្រុម","group",n?.groups),f("ថ្នាក់","class",n?.classes,!0),f("ផ្នែក","section",n?.sections),e.jsx("div",{className:"md:col-span-2",children:f("តួនាទី","position",n?.positions)})]})]})]})]}),e.jsxs("div",{className:"bg-white/60 p-6 rounded-3xl border border-white shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-6 pb-2 border-b border-slate-100",children:[e.jsx(qe,{className:"h-5 w-5 text-orange-500"}),e.jsx("h3",{className:"font-bold text-slate-800",children:"កាលវិភាគប្រចាំសប្តាហ៍"})]}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-4 lg:grid-cols-7 gap-4",children:["mon","tue","wed","thu","fri","sat","sun"].map((M,p)=>e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsx("label",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-wider text-center",children:["ចន្ទ","អង្គារ៍","ពុធ","ព្រហ","សុក្រ","សៅរ៍","អាទិត្យ"][p]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{name:M,value:t[M],onChange:S,className:"w-full py-3 pl-3 pr-8 border border-slate-200 rounded-xl bg-white text-xs font-bold text-slate-700 outline-none focus:ring-2 focus:ring-indigo-500/20 appearance-none cursor-pointer transition-all shadow-sm hover:border-indigo-300",children:[e.jsx("option",{value:"",children:"-"}),n?.schedules&&n.schedules.map(b=>e.jsx("option",{value:b,children:b},b))]}),e.jsx("div",{className:"absolute inset-y-0 right-2.5 flex items-center pointer-events-none text-slate-400",children:e.jsx(Xe,{className:"h-3.5 w-3.5"})})]})]},M))})]})]}),e.jsxs("div",{className:"px-8 py-5 bg-white border-t border-slate-100 flex justify-end gap-4 shrink-0",children:[e.jsx("button",{onClick:d,className:"px-8 py-3 rounded-xl text-slate-600 font-semibold hover:bg-slate-100 transition-colors",children:"បោះបង់"}),e.jsxs("button",{onClick:j,disabled:k||!_,className:"px-10 py-3 rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold shadow-lg shadow-indigo-200 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed transform hover:-translate-y-1 transition-all",children:[k?e.jsx(Ze,{className:"h-5 w-5 animate-spin"}):e.jsx(Je,{className:"h-5 w-5"})," ",c?"កែប្រែ":"រក្សាទុក"]})]})]})}):null}const G=s=>s?String(s).toLowerCase().replace(/\s+/g,""):"",ts=()=>{const[s,d]=o.useState([]),c=(i,n="success")=>{const t=Date.now();d(v=>[...v,{id:t,message:i,type:n}]),setTimeout(()=>l(t),3e3)},l=i=>d(n=>n.filter(t=>t.id!==i));return{toasts:s,addToast:c,removeToast:l}},as=o.memo(({employee:s,onEdit:d,onDelete:c,index:l})=>e.jsxs("div",{className:"group bg-white/70 backdrop-blur-md rounded-3xl border border-white/60 shadow-sm hover:shadow-xl hover:shadow-indigo-500/10 hover:-translate-y-2 transition-all duration-300 overflow-hidden flex flex-col animate-fade-in",style:{animationDelay:`${l*50}ms`},onDoubleClick:d,children:[e.jsxs("div",{className:"p-6 flex flex-col items-center text-center relative",children:[e.jsx("div",{className:"absolute top-0 left-0 w-full h-24 bg-gradient-to-br from-indigo-50 to-blue-50 z-0"}),e.jsxs("div",{className:"absolute top-3 right-3 flex gap-2 opacity-0 group-hover:opacity-100 transition-all duration-300 z-10 translate-x-2 group-hover:translate-x-0",children:[e.jsx("button",{onClick:i=>{i.stopPropagation(),d()},className:"text-indigo-600 bg-white hover:bg-indigo-50 p-2 rounded-xl shadow-sm transition-colors border border-indigo-100",children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx("button",{onClick:i=>{i.stopPropagation(),c()},className:"text-rose-500 bg-white hover:bg-rose-50 p-2 rounded-xl shadow-sm transition-colors border border-rose-100",children:e.jsx(Y,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"relative z-10 mt-4",children:[e.jsx("div",{className:"h-28 w-28 rounded-full border-4 border-white shadow-lg overflow-hidden mb-4 bg-white relative group-hover:ring-4 group-hover:ring-indigo-100 transition-all",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.name,className:"h-full w-full object-cover transform group-hover:scale-110 transition-transform duration-700"}):e.jsx("div",{className:"h-full w-full flex items-center justify-center text-slate-300",children:e.jsx(W,{className:"h-12 w-12"})})}),e.jsx("div",{className:"absolute bottom-5 right-1 h-5 w-5 bg-emerald-500 border-4 border-white rounded-full"})]}),e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-0.5",children:s.name}),e.jsx("p",{className:"text-slate-500 text-sm font-medium",children:s.latinName}),e.jsxs("div",{className:"mt-4 flex flex-wrap justify-center gap-2",children:[e.jsx("span",{className:"px-3 py-1 bg-blue-100/50 text-blue-600 rounded-lg text-xs font-bold",children:s.skill||"No Skill"}),e.jsx("span",{className:"px-3 py-1 bg-purple-100/50 text-purple-600 rounded-lg text-xs font-bold",children:s.group||"No Group"})]})]}),e.jsx("div",{className:"px-6 py-4 bg-slate-50/50 border-t border-slate-100 mt-auto backdrop-blur-sm",children:e.jsxs("div",{className:"grid grid-cols-2 gap-y-3 text-sm",children:[e.jsxs("div",{className:"text-slate-500 flex flex-col",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-400",children:"ID"}),e.jsx("span",{className:"font-semibold text-slate-700",children:s.studentId})]}),e.jsxs("div",{className:"text-slate-500 flex flex-col text-right",children:[e.jsx("span",{className:"text-[10px] uppercase font-bold text-slate-400",children:"Gender"}),e.jsx("span",{className:`font-semibold ${s.gender==="ស្រី"?"text-pink-500":"text-indigo-500"}`,children:s.gender})]}),e.jsxs("div",{className:"col-span-2 flex items-center gap-2 text-slate-500 truncate pt-2 border-t border-slate-200/50",children:[e.jsx("div",{className:"p-1.5 bg-blue-100 rounded-full text-blue-600",children:e.jsx(ve,{className:"h-3 w-3"})}),e.jsx("span",{className:"truncate text-xs font-medium text-blue-600 hover:underline cursor-pointer",children:s.telegram||"No Telegram"})]})]})})]})),ls=o.memo(({employee:s,onEdit:d,onDelete:c,onInlineUpdate:l,index:i,settings:n})=>e.jsxs("tr",{className:"group hover:bg-indigo-50/30 transition-colors animate-fade-in border-b border-slate-100 last:border-0",onDoubleClick:d,children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap sticky left-0 bg-white/90 backdrop-blur-sm group-hover:bg-indigo-50/50 z-20 border-r border-slate-100",children:e.jsxs("div",{className:"flex items-center gap-1 opacity-40 group-hover:opacity-100 transition-all transform translate-x-[-10px] group-hover:translate-x-0",children:[e.jsx("button",{onClick:t=>{t.stopPropagation(),d()},className:"text-indigo-600 hover:bg-indigo-100 p-2 rounded-lg transition-colors",children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx("button",{onClick:t=>{t.stopPropagation(),c()},className:"text-rose-500 hover:bg-rose-100 p-2 rounded-lg transition-colors",children:e.jsx(Y,{className:"h-4 w-4"})})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap sticky left-[88px] bg-white/90 backdrop-blur-sm group-hover:bg-indigo-50/50 z-20 border-r border-slate-100 shadow-[2px_0_5px_-2px_rgba(0,0,0,0.05)]",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full overflow-hidden shadow-sm ring-2 ring-white",children:s.imageUrl?e.jsx("img",{className:"h-full w-full object-cover",src:s.imageUrl,alt:""}):e.jsx("div",{className:"h-full w-full bg-slate-100 flex items-center justify-center text-slate-400",children:e.jsx(W,{className:"h-5 w-5"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("div",{className:"font-bold text-slate-800 text-sm",children:e.jsx(O,{value:s.name,onSave:t=>l(s.id,"ឈ្មោះ",t)})})})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600 font-medium",children:e.jsx(O,{value:s.latinName,onSave:t=>l(s.id,"ឈ្មោះឡាតាំង",t)})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm",children:e.jsx(O,{value:s.gender,onSave:t=>l(s.id,"ភេទ",t),options:Ue,className:`font-semibold ${s.gender==="ស្រី"?"text-pink-500":"text-indigo-500"}`})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600 font-mono",children:e.jsx("div",{className:"bg-slate-100 px-2 py-1 rounded text-center text-xs font-bold text-slate-700",children:e.jsx(O,{value:s.studentId,onSave:t=>l(s.id,"អត្តលេខ",t)})})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600",children:e.jsx(O,{value:s.skill,onSave:t=>l(s.id,"ជំនាញ",t),options:n?.skills})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-semibold text-slate-700",children:e.jsx(O,{value:s.group,onSave:t=>l(s.id,"ក្រុម",t),options:n?.groups})}),e.jsx("span",{className:"text-[10px] text-slate-400",children:e.jsx(O,{value:s.class,onSave:t=>l(s.id,"ថ្នាក់",t),options:n?.classes})})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600",children:e.jsx(O,{value:s.section,onSave:t=>l(s.id,"ផ្នែកការងារ",t),options:n?.sections})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600",children:e.jsx("div",{className:"px-2 py-1 bg-indigo-50 text-indigo-600 rounded border border-indigo-100 text-xs font-medium text-center",children:e.jsx(O,{value:s.position,onSave:t=>l(s.id,"តួនាទី",t),options:n?.positions})})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:e.jsx(O,{value:s.academicYear,onSave:t=>l(s.id,"ឆ្នាំសិក្សា",t),options:ne})}),e.jsxs("span",{className:"text-[10px] text-slate-400 flex items-center gap-1",children:["Gen: ",e.jsx(O,{value:s.generation,onSave:t=>l(s.id,"ជំនាន់",t),options:Fe})]})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600",children:e.jsx(O,{value:s.dob,onSave:t=>l(s.id,"ថ្ងៃខែឆ្នាំកំណើត",t)})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-slate-600 max-w-xs truncate",title:s.pob,children:e.jsx(O,{value:s.pob,onSave:t=>l(s.id,"ទីកន្លែងកំណើត",t)})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-sm text-blue-500 cursor-pointer font-medium hover:underline",children:e.jsx(O,{value:s.telegram,onSave:t=>l(s.id,"តេឡេក្រាម",t)})}),["mon","tue","wed","thu","fri","sat","sun"].map((t,v)=>{const k=["ចន្ទ","អង្គារ៍","ពុធ","ព្រហស្បត្តិ៍","សុក្រ","សៅរ៍","អាទិត្យ"][v];return e.jsx("td",{className:"px-4 py-3 whitespace-nowrap text-center border-l border-slate-100 text-sm font-medium text-slate-700 bg-slate-50/30",children:e.jsx(O,{value:s[t],onSave:C=>l(s.id,`កាលវិភាគ/${k}`,C),options:n?.schedules})},t)})]}),(s,d)=>s.employee===d.employee&&s.index===d.index&&s.settings===d.settings),rs=o.memo(({employee:s,onRestore:d,onPermanentDelete:c,index:l})=>e.jsxs("tr",{className:"group hover:bg-red-50/50 transition-colors animate-fade-in border-b border-slate-100",children:[e.jsx("td",{className:"px-4 py-3 whitespace-nowrap sticky left-0 bg-white/90 backdrop-blur-sm group-hover:bg-red-50/30 z-20 border-r border-slate-100",children:e.jsxs("div",{className:"flex items-center gap-2 opacity-60 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>d(s),className:"text-emerald-600 hover:bg-emerald-100 p-2 rounded-lg transition-colors",title:"ស្តារវិញ",children:e.jsx(le,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>c(s.id),className:"text-red-600 hover:bg-red-100 p-2 rounded-lg transition-colors",title:"លុបជារៀងរហូត",children:e.jsx(Y,{className:"h-4 w-4"})})]})}),e.jsx("td",{className:"px-4 py-3 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 border-2 border-slate-100 rounded-full overflow-hidden opacity-70 grayscale",children:s.imageUrl?e.jsx("img",{className:"h-full w-full object-cover",src:s.imageUrl,alt:""}):e.jsx("div",{className:"h-full w-full bg-slate-100 flex items-center justify-center text-slate-400",children:e.jsx(W,{className:"h-5 w-5"})})}),e.jsx("div",{className:"ml-3",children:e.jsx("div",{className:"font-bold text-slate-700 text-sm",children:s.name})})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-slate-500",children:s.latinName}),e.jsx("td",{className:"px-4 py-3 text-sm font-mono bg-slate-50 rounded text-center",children:s.studentId}),e.jsx("td",{className:"px-4 py-3 text-sm text-red-400 italic",children:"Deleted just now"})]})),Q=({employees:s,loading:d,settings:c,isRecycleBin:l=!1,onEdit:i,onDelete:n,onRestore:t,onPermanentDelete:v,onInlineUpdate:k,onCreate:C})=>{const[D,x]=o.useState(window.innerWidth<768?"grid":"list"),[N,$]=o.useState(""),[S,y]=o.useState(1),A=50,j=o.useRef(null),_=o.useRef(!1),f=o.useRef(0),M=o.useRef(0),p=m=>{_.current=!0,j.current&&(f.current=m.pageX-j.current.offsetLeft,M.current=j.current.scrollLeft,j.current.classList.add("cursor-grabbing"))},b=()=>{_.current=!1,j.current&&j.current.classList.remove("cursor-grabbing")},E=()=>{_.current=!1,j.current&&j.current.classList.remove("cursor-grabbing")},z=m=>{if(_.current&&(m.preventDefault(),j.current)){const L=(m.pageX-j.current.offsetLeft-f.current)*2;j.current.scrollLeft=M.current-L}},P=o.useMemo(()=>{if(!N)return s;const m=G(N);return s.filter(h=>G(h.name).includes(m)||G(h.latinName).includes(m)||G(h.studentId).includes(m))},[s,N]);o.useEffect(()=>y(1),[N]);const r=P.slice((S-1)*A,S*A),a=Math.ceil(P.length/A),u=({className:m})=>e.jsxs("div",{className:m,children:[e.jsxs("div",{className:"text-xs font-medium text-slate-500 mb-2 md:mb-0",children:["Showing ",P.length>0?(S-1)*A+1:0," to ",Math.min(S*A,P.length)," of ",P.length]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>y(h=>Math.max(h-1,1)),disabled:S===1,className:"p-2 rounded-lg bg-white border border-slate-200 hover:bg-slate-50 disabled:opacity-50 text-slate-600 shadow-sm transition-all active:scale-95",children:e.jsx(Ce,{className:"h-4 w-4"})}),e.jsxs("div",{className:"px-4 py-1.5 bg-white border border-slate-200 rounded-lg text-sm font-bold text-slate-700 shadow-sm min-w-[80px] text-center flex items-center justify-center",children:[S," / ",Math.max(a,1)]}),e.jsx("button",{onClick:()=>y(h=>Math.min(h+1,a)),disabled:S===a||a===0,className:"p-2 rounded-lg bg-white border border-slate-200 hover:bg-slate-50 disabled:opacity-50 text-slate-600 shadow-sm transition-all active:scale-95",children:e.jsx(Se,{className:"h-4 w-4"})})]})]});return e.jsxs("div",{className:"space-y-6 animate-fade-in",children:[e.jsxs("div",{className:"glass-panel p-4 rounded-3xl flex flex-col md:flex-row justify-between items-center gap-4 sticky top-0 z-20",children:[e.jsxs("div",{className:"relative w-full md:w-96 group",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:e.jsx(X,{className:"h-5 w-5 text-slate-400 group-focus-within:text-indigo-500 transition-colors"})}),e.jsx("input",{type:"text",className:"block w-full pl-12 pr-4 py-3 border-none rounded-2xl bg-white/50 focus:bg-white ring-1 ring-slate-200 focus:ring-2 focus:ring-indigo-500/50 outline-none transition-all placeholder:text-slate-400 font-medium",placeholder:"ស្វែងរក...",value:N,onChange:m=>$(m.target.value)})]}),e.jsx("div",{className:"flex items-center justify-between w-full md:w-auto gap-3",children:!l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white/50 p-1.5 rounded-xl flex items-center ring-1 ring-slate-200",children:[e.jsx("button",{onClick:()=>x("grid"),className:`p-2.5 rounded-lg transition-all ${D==="grid"?"bg-white text-indigo-600 shadow-md":"text-slate-400 hover:text-slate-600"}`,children:e.jsx(ee,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>x("list"),className:`p-2.5 rounded-lg transition-all ${D==="list"?"bg-white text-indigo-600 shadow-md":"text-slate-400 hover:text-slate-600"}`,children:e.jsx(ge,{className:"h-5 w-5"})})]}),e.jsxs("button",{onClick:C,className:"flex-1 md:flex-none flex items-center justify-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-3 rounded-2xl font-bold shadow-lg shadow-indigo-200 hover:-translate-y-1 transition-all",children:[e.jsx(pe,{className:"h-5 w-5"}),e.jsx("span",{className:"hidden sm:inline",children:"បង្កើតថ្មី"}),e.jsx("span",{className:"sm:hidden",children:"New"})]})]})})]}),d?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 animate-pulse",children:[1,2,3].map(m=>e.jsx("div",{className:"bg-white/50 h-64 rounded-3xl"},m))}):P.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-20 bg-white/40 rounded-3xl border-2 border-dashed border-slate-300",children:[e.jsx("div",{className:"bg-slate-100 p-6 rounded-full mb-4 text-slate-400",children:l?e.jsx(Y,{className:"h-10 w-10"}):e.jsx(X,{className:"h-10 w-10"})}),e.jsx("h3",{className:"text-xl font-bold text-slate-700",children:"មិនមានទិន្នន័យ"})]}):e.jsx(e.Fragment,{children:D==="grid"&&!l?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:r.map((m,h)=>e.jsx(as,{employee:m,onEdit:()=>i(m),onDelete:()=>n(m.id),index:h},m.id))}),e.jsx(u,{className:"glass-panel p-4 rounded-2xl flex flex-col md:flex-row justify-between items-center bg-white/80 mt-6"})]}):e.jsxs("div",{className:"glass-panel rounded-3xl overflow-hidden pb-0 bg-white/80",children:[e.jsx("div",{ref:j,className:"overflow-x-auto cursor-grab active:cursor-grabbing custom-scrollbar",onMouseDown:p,onMouseLeave:b,onMouseUp:E,onMouseMove:z,children:e.jsxs("table",{className:"min-w-full divide-y divide-slate-100",children:[e.jsx("thead",{className:"bg-slate-50/80 backdrop-blur-md",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-xs font-extrabold text-slate-500 uppercase tracking-wider sticky left-0 bg-slate-50 z-30 shadow-[4px_0_10px_-4px_rgba(0,0,0,0.05)]",children:"Action"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-extrabold text-slate-500 uppercase tracking-wider sticky left-[88px] bg-slate-50 z-30 shadow-[4px_0_10px_-4px_rgba(0,0,0,0.05)]",children:"Profile"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-extrabold text-slate-500 uppercase tracking-wider min-w-[140px]",children:"Latin Name"}),l?e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-4 text-left text-xs font-bold text-slate-500 uppercase",children:"ID"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-bold text-slate-500 uppercase",children:"Status"})]}):e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"px-4 py-4 text-left text-xs font-extrabold text-slate-500 uppercase tracking-wider min-w-[100px]",children:"Gender"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-extrabold text-slate-500 uppercase tracking-wider min-w-[120px]",children:"ID"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-extrabold text-slate-500 uppercase tracking-wider min-w-[150px]",children:"Skill"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-extrabold text-slate-500 uppercase tracking-wider min-w-[150px]",children:"Group Info"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-extrabold text-slate-500 uppercase tracking-wider min-w-[150px]",children:"Section"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-extrabold text-slate-500 uppercase tracking-wider min-w-[150px]",children:"Position"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-extrabold text-slate-500 uppercase tracking-wider min-w-[150px]",children:"Academic"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-extrabold text-slate-500 uppercase tracking-wider min-w-[120px]",children:"DOB"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-extrabold text-slate-500 uppercase tracking-wider min-w-[150px]",children:"POB"}),e.jsx("th",{className:"px-4 py-4 text-left text-xs font-extrabold text-slate-500 uppercase tracking-wider min-w-[150px]",children:"Telegram"}),["Mon","Tue","Wed","Thu","Fri","Sat","Sun"].map(m=>e.jsx("th",{className:"px-4 py-4 text-center text-xs font-extrabold text-slate-500 uppercase border-l border-slate-200/50 min-w-[100px] bg-slate-100/30",children:m},m))]})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:r.map((m,h)=>l?e.jsx(rs,{employee:m,onRestore:t,onPermanentDelete:v,index:h},m.id):e.jsx(ls,{employee:m,onEdit:()=>i(m),onDelete:()=>n(m.id),onInlineUpdate:k,index:h,settings:c},m.id))})]})}),e.jsx(u,{className:"flex flex-col md:flex-row justify-between items-center px-6 py-4 border-t border-slate-100 bg-slate-50/50"})]})})]})};function ns(){const[s,d]=o.useState(null),[c,l]=o.useState(!1),[i,n]=o.useState([]),[t,v]=o.useState([]),[k,C]=o.useState({}),[D,x]=o.useState(!0),[N,$]=o.useState(!1),[S,y]=o.useState(null),[A,j]=o.useState({isOpen:!1,title:"",message:"",onConfirm:null,type:"danger"}),{toasts:_,addToast:f,removeToast:M}=ts();o.useEffect(()=>{const a=J.onAuthStateChanged(u=>d(u));return J.signInAnonymously().catch(u=>{console.error("Sign in failed:",u),f("បរាជ័យក្នុងការ Sign In","error")}),()=>a()},[]),o.useEffect(()=>{if(!s)return;const a=R.ref("students"),u=R.ref("deleted_students"),m=R.ref("settings"),h=(L,U)=>{const B=L.val();if(B){const K=Object.keys(B).map(Z=>{const w=B[Z]||{},F=w.កាលវិភាគ||{};return{id:Z,imageUrl:I(w.រូបថត||w.imageUrl),name:I(w.ឈ្មោះ||w.name),latinName:I(w.ឈ្មោះឡាតាំង),gender:I(w.ភេទ),dob:I(w.ថ្ងៃខែឆ្នាំកំណើត),pob:I(w.ទីកន្លែងកំណើត),studentId:I(w.អត្តលេខ),academicYear:I(w.ឆ្នាំសិក្សា),generation:I(w.ជំនាន់),group:I(w.ក្រុម),class:I(w.ថ្នាក់),skill:I(w.ជំនាញ),section:I(w.ផ្នែកការងារ),position:I(w.តួនាទី),telegram:I(w.តេឡេក្រាម),mon:I(F.ចន្ទ||w.ចន្ទ),tue:I(F.អង្គារ៍||w.អង្គារ៍),wed:I(F.ពុធ||w.ពុធ),thu:I(F.ព្រហស្បត្តិ៍||w.ព្រហស្បត្តិ៍),fri:I(F.សុក្រ||w.សុក្រ),sat:I(F.សៅរ៍||w.សៅរ៍),sun:I(F.អាទិត្យ||w.អាទិត្យ),originalData:w}});U(K.reverse())}else U([])};return a.on("value",L=>{h(L,n),x(!1)}),u.on("value",L=>h(L,v)),m.on("value",L=>C(L.val()||{})),()=>{a.off(),u.off(),m.off()}},[s]);const p=o.useMemo(()=>({total:i.length,male:i.filter(a=>a.gender==="ប្រុស").length,female:i.filter(a=>a.gender==="ស្រី").length}),[i]),b=o.useCallback(a=>{const u=i.find(m=>m.id===a);j({isOpen:!0,type:"danger",title:"បញ្ជាក់ការលុប",message:`តើអ្នកពិតជាចង់លុប "${u?.name}" ទៅកាន់ធុងសំរាមមែនទេ?`,onConfirm:async()=>{try{await R.ref(`deleted_students/${u.id}`).set({...u.originalData,deletedAt:Date.now()}),await R.ref(`students/${u.id}`).remove(),j(m=>({...m,isOpen:!1})),f("បានបញ្ជូនទៅធុងសំរាម","success")}catch{f("បរាជ័យក្នុងការលុប","error")}}})},[i]),E=o.useCallback(a=>{j({isOpen:!0,type:"restore",title:"បញ្ជាក់ការស្តារ",message:`តើអ្នកចង់ស្តារ "${a.name}" ត្រឡប់មកវិញទេ?`,onConfirm:async()=>{try{await R.ref(`students/${a.id}`).set(a.originalData),await R.ref(`deleted_students/${a.id}`).remove(),j(u=>({...u,isOpen:!1})),f("បានស្តារទិន្នន័យជោគជ័យ","success")}catch{f("បរាជ័យ","error")}}})},[]),z=o.useCallback(a=>{j({isOpen:!0,type:"danger",title:"លុបជារៀងរហូត",message:"តើអ្នកចង់លុបជារៀងរហូតមែនទេ? ទិន្នន័យមិនអាចយកមកវិញបានទេ។",onConfirm:async()=>{try{await R.ref(`deleted_students/${a}`).remove(),j(u=>({...u,isOpen:!1})),f("លុបជាស្ថាពរជោគជ័យ","success")}catch{f("បរាជ័យ","error")}}})},[]),P=o.useCallback(async(a,u,m)=>{try{await R.ref(`students/${a}`).update({[u]:m})}catch{f("បរាជ័យក្នុងការកែប្រែ","error")}},[]),r=()=>{const a=ie(),u=oe(),m=()=>{switch(a.pathname){case"/":return"Dashboard Overview";case"/employees":return"Employee Management";case"/recycle-bin":return"Recycle Bin";case"/settings":return"System Settings";case"/bulk-edit":return"Bulk Edit Mode";default:return"HR Pro"}};return e.jsxs("div",{className:"flex h-screen overflow-hidden",children:[e.jsxs("aside",{className:`fixed inset-y-4 left-4 z-50 w-72 glass-sidebar rounded-3xl transform transition-transform duration-500 ease-in-out md:relative md:translate-x-0 md:inset-y-0 md:left-0 md:rounded-none md:border-r md:bg-slate-900 ${c?"translate-x-0":"-translate-x-[120%] md:translate-x-0"} flex flex-col shadow-2xl`,children:[e.jsx("div",{className:"h-24 flex items-center justify-center border-b border-white/5",children:e.jsxs("div",{className:"flex items-center gap-3 font-extrabold text-2xl tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-400",children:[e.jsx(ue,{className:"h-8 w-8 text-blue-500"})," HR PRO"]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto py-8 px-4 space-y-2",children:[e.jsx("p",{className:"px-4 text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"Menu"}),e.jsxs(V,{to:"/",onClick:()=>l(!1),className:({isActive:h})=>`w-full flex items-center gap-4 px-6 py-4 rounded-2xl transition-all duration-300 font-bold ${h?"active-nav-item shadow-lg shadow-blue-900/20":"text-slate-400 hover:bg-white/5 hover:text-white"}`,children:[e.jsx(ee,{className:"h-5 w-5"})," ផ្ទាំងគ្រប់គ្រង"]}),e.jsxs(V,{to:"/employees",onClick:()=>l(!1),className:({isActive:h})=>`w-full flex items-center gap-4 px-6 py-4 rounded-2xl transition-all duration-300 font-bold ${h?"active-nav-item shadow-lg shadow-blue-900/20":"text-slate-400 hover:bg-white/5 hover:text-white"}`,children:[e.jsx(te,{className:"h-5 w-5"})," បុគ្គលិក"]}),e.jsxs(V,{to:"/bulk-edit",onClick:()=>l(!1),className:({isActive:h})=>`w-full flex items-center gap-4 px-6 py-4 rounded-2xl transition-all duration-300 font-bold ${h?"active-nav-item shadow-lg shadow-blue-900/20":"text-slate-400 hover:bg-white/5 hover:text-white"}`,children:[e.jsx(Oe,{className:"h-5 w-5"})," កែប្រែទិន្នន័យ"]}),e.jsxs(V,{to:"/recycle-bin",onClick:()=>l(!1),className:({isActive:h})=>`w-full flex items-center gap-4 px-6 py-4 rounded-2xl transition-all duration-300 font-bold ${h?"bg-red-500/10 text-red-400 border-l-4 border-red-500":"text-slate-400 hover:bg-white/5 hover:text-white"}`,children:[e.jsx(Y,{className:"h-5 w-5"})," ធុងសំរាម"]}),e.jsx("div",{className:"my-6 border-t border-white/5"}),e.jsx("p",{className:"px-4 text-xs font-bold text-slate-500 uppercase tracking-wider mb-2",children:"System"}),e.jsxs(V,{to:"/settings",onClick:()=>l(!1),className:({isActive:h})=>`w-full flex items-center gap-4 px-6 py-4 rounded-2xl transition-all duration-300 font-bold ${h?"active-nav-item shadow-lg shadow-blue-900/20":"text-slate-400 hover:bg-white/5 hover:text-white"}`,children:[e.jsx(re,{className:"h-5 w-5"})," ការកំណត់"]})]}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"bg-gradient-to-br from-indigo-600 to-blue-700 rounded-2xl p-4 text-center",children:[e.jsx("p",{className:"text-white text-xs font-medium opacity-80 mb-2",children:"Logged in as Admin"}),e.jsxs("button",{className:"w-full flex items-center justify-center gap-2 px-4 py-2 rounded-xl bg-white/20 hover:bg-white/30 text-white transition-all text-sm font-bold backdrop-blur-sm",children:[e.jsx(De,{className:"h-4 w-4"})," Sign Out"]})]})})]}),c&&e.jsx("div",{className:"fixed inset-0 bg-black/60 z-40 md:hidden backdrop-blur-sm transition-opacity",onClick:()=>l(!1)}),e.jsxs("div",{className:"flex-1 flex flex-col h-full overflow-hidden relative",children:[e.jsxs("header",{className:"h-20 glass-panel border-b-0 m-4 rounded-3xl flex items-center justify-between px-8 z-30 shrink-0 sticky top-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>l(!0),className:"md:hidden p-2 rounded-xl hover:bg-slate-100 text-slate-600",children:e.jsx(Le,{className:"h-6 w-6"})}),e.jsx("h1",{className:"text-2xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-slate-700 to-slate-500 hidden sm:block",children:m()})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Ee,{className:"h-6 w-6 text-slate-400 hover:text-indigo-500 transition-colors cursor-pointer"}),e.jsx("span",{className:"absolute -top-1 -right-1 h-3 w-3 bg-red-500 rounded-full border-2 border-white"})]}),e.jsx("div",{className:"h-8 w-[1px] bg-slate-200"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"text-right hidden md:block",children:[e.jsx("div",{className:"text-sm font-bold text-slate-700",children:"Admin User"}),e.jsx("div",{className:"text-xs text-slate-400 font-medium",children:"Super Admin"})]}),e.jsx("div",{className:"h-10 w-10 rounded-full bg-gradient-to-r from-blue-500 to-indigo-600 flex items-center justify-center text-white font-bold shadow-lg ring-2 ring-white",children:"A"})]})]})]}),e.jsx("main",{className:"flex-1 overflow-y-auto px-4 pb-4 md:px-8 md:pb-8 custom-scrollbar",children:e.jsxs(de,{children:[e.jsx(T,{path:"/",element:e.jsx(_e,{stats:p,onNavigate:h=>u(h)})}),e.jsx(T,{path:"/employees",element:e.jsx(Q,{employees:i,loading:D,settings:k,onEdit:h=>{y(h),$(!0)},onDelete:b,onInlineUpdate:P,onCreate:()=>{y(null),$(!0)}})}),e.jsx(T,{path:"/recycle-bin",element:e.jsx(Q,{employees:t,loading:D,isRecycleBin:!0,onRestore:E,onPermanentDelete:z})}),e.jsx(T,{path:"/bulk-edit",element:e.jsx(Ye,{db:R,employees:i,settings:k,addToast:f,setConfirmDialog:j})}),e.jsx(T,{path:"/settings",element:e.jsx(ze,{db:R,settings:k,setConfirmDialog:j,addToast:f})})]})})]})]})};return e.jsxs(e.Fragment,{children:[e.jsx(r,{}),N&&e.jsx(ss,{isOpen:N,onClose:()=>$(!1),employee:S,db:R,addToast:f,settings:k}),e.jsx(Re,{isOpen:A.isOpen,onClose:()=>j(a=>({...a,isOpen:!1})),...A}),e.jsx(Pe,{toasts:_,removeToast:M})]})}ce.createRoot(document.getElementById("root")).render(e.jsx(xe.StrictMode,{children:e.jsx(he,{children:e.jsx(ns,{})})}));
